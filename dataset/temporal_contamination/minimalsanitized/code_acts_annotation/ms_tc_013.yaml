schema_version: "1.0"
sample_id: "ms_tc_013"
vulnerability_type: "arithmetic_error"
vulnerable_lines: [81]

# Full line coverage for scoring. UNRELATED items are batched for efficiency.
# Detailed rationales only for security-relevant code acts.

code_acts:

  # ============================================
  # SECURITY-RELEVANT CODE ACTS (detailed)
  # ============================================

  - id: "CA1"
    type: "DECLARATION"
    lines: [30]
    code: "mapping(address => uint256) public depositedLP;"
    security_function: "BENIGN"
    rationale: "User LP deposit tracking. Not directly involved in vulnerability."

  - id: "CA2"
    type: "DECLARATION"
    lines: [31]
    code: "mapping(address => uint256) public earnedRewards;"
    security_function: "PREREQ"
    rationale: "PREREQ - Reward tracking that gets inflated due to the arithmetic error in mintFor."

  - id: "CA3"
    type: "DECLARATION"
    lines: [33]
    code: "uint256 public constant REWARD_RATE = 100;"
    security_function: "PREREQ"
    rationale: "PREREQ - Multiplier applied to the inflated balance, amplifying the impact."

  - id: "CA4"
    type: "EXT_CALL"
    lines: [44]
    code: "lpToken.transferFrom(msg.sender, address(this), amount);"
    security_function: "BENIGN"
    rationale: "LP token deposit transfer. Correctly implemented."

  - id: "CA5"
    type: "STATE_MOD"
    lines: [45]
    code: "depositedLP[msg.sender] += amount;"
    security_function: "BENIGN"
    rationale: "Deposit state update. Correctly implemented."

  - id: "CA6"
    type: "INPUT_VAL"
    lines: [73]
    code: 'require(flip == address(lpToken), "Invalid token");'
    security_function: "BENIGN"
    rationale: "Token validation in mintFor. Correctly validates the flip parameter."

  - id: "CA7"
    type: "COMPUTATION"
    lines: [76]
    code: "uint256 feeSum = _performanceFee + _withdrawalFee;"
    security_function: "PREREQ"
    rationale: "PREREQ - Fee calculation. The fees transferred in are meant to be the basis for rewards, but the actual reward uses total balance instead."

  - id: "CA8"
    type: "EXT_CALL"
    lines: [77]
    code: "lpToken.transferFrom(msg.sender, address(this), feeSum);"
    security_function: "PREREQ"
    rationale: "PREREQ - Fee transfer that adds to contract's LP balance. The transferred amount should be basis for reward, but is not used directly."

  - id: "CA9"
    type: "COMPUTATION"
    lines: [80, 81, 82]
    code: |
      uint256 hunnyRewardAmount = tokenToReward(
          lpToken.balanceOf(address(this))
      );
    security_function: "ROOT_CAUSE"
    rationale: "ROOT_CAUSE - Uses TOTAL contract LP balance instead of just the fee amount. Attacker can inflate rewards by depositing LP tokens before calling mintFor. The reward should be based on feeSum, not total balance."

  - id: "CA10"
    type: "STATE_MOD"
    lines: [85]
    code: "earnedRewards[to] += hunnyRewardAmount;"
    security_function: "PREREQ"
    rationale: "PREREQ - Assigns inflated reward amount to recipient. Enables attacker to claim massive rewards."

  - id: "CA11"
    type: "COMPUTATION"
    lines: [92, 93, 94]
    code: |
      function tokenToReward(uint256 lpAmount) internal pure returns (uint256) {
          return lpAmount * REWARD_RATE;
      }
    security_function: "PREREQ"
    rationale: "PREREQ - Multiplies the already-inflated LP amount by REWARD_RATE (100x), further amplifying the exploit."

  - id: "CA12"
    type: "INPUT_VAL"
    lines: [100, 101]
    code: |
      uint256 reward = earnedRewards[msg.sender];
      require(reward > 0, "No rewards");
    security_function: "BENIGN"
    rationale: "Reward claim validation. Correctly checks for non-zero rewards."

  - id: "CA13"
    type: "STATE_MOD"
    lines: [103]
    code: "earnedRewards[msg.sender] = 0;"
    security_function: "BENIGN"
    rationale: "Clears rewards before transfer. Correctly prevents reentrancy."

  - id: "CA14"
    type: "EXT_CALL"
    lines: [104]
    code: "rewardToken.transfer(msg.sender, reward);"
    security_function: "BENIGN"
    rationale: "Reward token transfer. State cleared before call."

  - id: "CA15"
    type: "INPUT_VAL"
    lines: [111]
    code: 'require(depositedLP[msg.sender] >= amount, "Insufficient balance");'
    security_function: "BENIGN"
    rationale: "Withdrawal balance check. Correctly implemented."

  - id: "CA16"
    type: "STATE_MOD"
    lines: [112]
    code: "depositedLP[msg.sender] -= amount;"
    security_function: "BENIGN"
    rationale: "Withdrawal state update. Correctly implemented."

  - id: "CA17"
    type: "EXT_CALL"
    lines: [113]
    code: "lpToken.transfer(msg.sender, amount);"
    security_function: "BENIGN"
    rationale: "LP token withdrawal transfer. State updated before call."

  # ============================================
  # BATCHED UNRELATED CODE ACTS (for scoring)
  # ============================================

  - id: "CA_DIRECTIVES"
    type: "DIRECTIVE"
    lines: [1, 2]
    security_function: "UNRELATED"
    rationale: "License and pragma statements"

  - id: "CA_COMMENTS"
    type: "COMMENT"
    lines: [40, 41, 42, 48, 49, 50, 51, 52, 53, 54, 57, 58, 60, 61, 62, 63, 64, 65, 75, 88, 89, 90, 91, 96, 97, 98, 107, 108, 109]
    security_function: "UNRELATED"
    rationale: "Inline comments and NatSpec documentation"

  - id: "CA_DECLARATIONS"
    type: "DECLARATION"
    lines: [4, 5, 7, 8, 9, 10, 11, 13, 14, 16, 17, 18, 19, 20, 21, 22, 23, 24, 26, 27, 28, 35, 36, 37, 38, 43, 66, 67, 68, 69, 70, 71, 72, 99, 105, 110, 114, 115]
    security_function: "UNRELATED"
    rationale: "Interface, contract, constructor, and function signature declarations"

  - id: "CA_SYNTAX"
    type: "SYNTAX"
    lines: [46, 86]
    security_function: "UNRELATED"
    rationale: "Closing braces"

summary:
  total_code_acts: 21
  total_lines_covered: 93  # excludes 28 empty lines

  by_security_function:
    ROOT_CAUSE: 1      # CA9
    PREREQ: 6          # CA2, CA3, CA7, CA8, CA10, CA11
    BENIGN: 10         # CA1, CA4, CA5, CA6, CA12, CA13, CA14, CA15, CA16, CA17
    UNRELATED: 4       # batched

  root_causes:
    - id: "CA9"
      lines: [80, 81, 82]
      type: "COMPUTATION"
      description: "Uses total LP balance instead of fee amount for reward calculation"

  prerequisites:
    - id: "CA2"
      description: "Reward mapping that receives inflated amount"
    - id: "CA3"
      description: "Reward rate multiplier amplifying exploit"
    - id: "CA7"
      description: "Fee calculation (correct but unused)"
    - id: "CA8"
      description: "Fee transfer adds to total balance"
    - id: "CA10"
      description: "Assigns inflated reward"
    - id: "CA11"
      description: "tokenToReward multiplies inflated amount"

line_to_code_act:
  # Directives (UNRELATED)
  1: "CA_DIRECTIVES"
  2: "CA_DIRECTIVES"
  # Line 3: empty
  # IERC20 interface (UNRELATED)
  4: "CA_DECLARATIONS"
  5: "CA_DECLARATIONS"
  # Line 6: empty
  7: "CA_DECLARATIONS"
  8: "CA_DECLARATIONS"
  9: "CA_DECLARATIONS"
  10: "CA_DECLARATIONS"
  11: "CA_DECLARATIONS"
  # Line 12: empty
  13: "CA_DECLARATIONS"
  14: "CA_DECLARATIONS"
  # Line 15: empty
  # IPancakeRouter interface (UNRELATED)
  16: "CA_DECLARATIONS"
  17: "CA_DECLARATIONS"
  18: "CA_DECLARATIONS"
  19: "CA_DECLARATIONS"
  20: "CA_DECLARATIONS"
  21: "CA_DECLARATIONS"
  22: "CA_DECLARATIONS"
  23: "CA_DECLARATIONS"
  24: "CA_DECLARATIONS"
  # Line 25: empty
  # HunnyMinter contract
  26: "CA_DECLARATIONS"
  27: "CA_DECLARATIONS"
  28: "CA_DECLARATIONS"
  # Line 29: empty
  30: "CA1"
  31: "CA2"
  # Line 32: empty
  33: "CA3"
  # Line 34: empty
  35: "CA_DECLARATIONS"
  36: "CA_DECLARATIONS"
  37: "CA_DECLARATIONS"
  38: "CA_DECLARATIONS"
  # Line 39: empty
  40: "CA_COMMENTS"
  41: "CA_COMMENTS"
  42: "CA_COMMENTS"
  43: "CA_DECLARATIONS"
  44: "CA4"
  45: "CA5"
  46: "CA_SYNTAX"
  # Line 47: empty
  48: "CA_COMMENTS"
  49: "CA_COMMENTS"
  50: "CA_COMMENTS"
  51: "CA_COMMENTS"
  52: "CA_COMMENTS"
  53: "CA_COMMENTS"
  54: "CA_COMMENTS"
  # Line 55: empty
  # Line 56: empty
  57: "CA_COMMENTS"
  58: "CA_COMMENTS"
  # Line 59: empty
  60: "CA_COMMENTS"
  61: "CA_COMMENTS"
  62: "CA_COMMENTS"
  63: "CA_COMMENTS"
  64: "CA_COMMENTS"
  65: "CA_COMMENTS"
  66: "CA_DECLARATIONS"
  67: "CA_DECLARATIONS"
  68: "CA_DECLARATIONS"
  69: "CA_DECLARATIONS"
  70: "CA_DECLARATIONS"
  71: "CA_DECLARATIONS"
  72: "CA_DECLARATIONS"
  73: "CA6"
  # Line 74: empty
  75: "CA_COMMENTS"
  76: "CA7"
  77: "CA8"
  # Line 78: empty
  # Line 79: empty
  80: "CA9"
  81: "CA9"
  82: "CA9"
  # Line 83: empty
  # Line 84: empty
  85: "CA10"
  86: "CA_SYNTAX"
  # Line 87: empty
  88: "CA_COMMENTS"
  89: "CA_COMMENTS"
  90: "CA_COMMENTS"
  91: "CA_COMMENTS"
  92: "CA11"
  93: "CA11"
  94: "CA11"
  # Line 95: empty
  96: "CA_COMMENTS"
  97: "CA_COMMENTS"
  98: "CA_COMMENTS"
  99: "CA_DECLARATIONS"
  100: "CA12"
  101: "CA12"
  # Line 102: empty
  103: "CA13"
  104: "CA14"
  105: "CA_DECLARATIONS"
  # Line 106: empty
  107: "CA_COMMENTS"
  108: "CA_COMMENTS"
  109: "CA_COMMENTS"
  110: "CA_DECLARATIONS"
  111: "CA15"
  112: "CA16"
  113: "CA17"
  114: "CA_DECLARATIONS"
  115: "CA_DECLARATIONS"

code_act_security_functions:
  CA1: "BENIGN"
  CA2: "PREREQ"
  CA3: "PREREQ"
  CA4: "BENIGN"
  CA5: "BENIGN"
  CA6: "BENIGN"
  CA7: "PREREQ"
  CA8: "PREREQ"
  CA9: "ROOT_CAUSE"
  CA10: "PREREQ"
  CA11: "PREREQ"
  CA12: "BENIGN"
  CA13: "BENIGN"
  CA14: "BENIGN"
  CA15: "BENIGN"
  CA16: "BENIGN"
  CA17: "BENIGN"
  CA_DIRECTIVES: "UNRELATED"
  CA_COMMENTS: "UNRELATED"
  CA_DECLARATIONS: "UNRELATED"
  CA_SYNTAX: "UNRELATED"
