{
  "sample_id": "gs_spearbit_aragon-lock-to-vote_H02",
  "exploit_name": "Proposals created with voting mode EarlyExecution are vulnerable to flashloan attacks",
  "date": "2025-09-11",
  "amount_lost_usd": null,
  "blockchain": "ethereum",
  "language": "solidity",
  "vulnerability_type": "flash_loan",
  "vulnerability_subtype": "H-02",
  "severity": "high",
  "difficulty_tier": 3,
  "is_vulnerable": true,
  "temporal_category": "post_cutoff",
  "description": "If the token used by the LockManager can be flashloaned (or flashminted) and a proposal is created with the voting mode EarlyExecution, anyone could be able to 'early execute' it by flashloaning tokens, locking them, casting a YES vote to trigger early execution, unlocking tokens, and repaying the flashloan - all in one transaction. The vulnerable code is in LockToVotePlugin.vote() at lines 205-207 which calls _attemptEarlyExecution() when VotingMode.EarlyExecution is set.",
  "vulnerable_contract": "LockToVotePlugin",
  "vulnerable_function": "vote",
  "vulnerable_lines": [
    145,
    146,
    147,
    148,
    149,
    150,
    151,
    152,
    153,
    154,
    155,
    156,
    157,
    158,
    159,
    160,
    161,
    162,
    163,
    164,
    165,
    166,
    167,
    168,
    169,
    170,
    171,
    172,
    173,
    174,
    175,
    176,
    177,
    178,
    179,
    180,
    181,
    182,
    183,
    184,
    185,
    186,
    187,
    188,
    189,
    190,
    191,
    192,
    193,
    194,
    195,
    196,
    197,
    198,
    199,
    200,
    201,
    202,
    203,
    204,
    205,
    206,
    207,
    208,
    302,
    303,
    304,
    305,
    306,
    307,
    308,
    309,
    310
  ],
  "attack_scenario": "1. Flashloan the needed amount.\n2. Lock the flashloaned amount via LockManager.lock().\n3. Cast a 'YES' vote via LockManager.vote() which triggers LockToVotePlugin._attemptEarlyExecution().\n4. Proposal executes immediately in same transaction.\n5. Unlock the tokens via LockManager.unlock().\n6. Repay the flashloan.",
  "root_cause": "If the token used by the LockManager can be flashloaned (or flashminted) and a proposal is created with the voting mode EarlyExecution, anyone could be able to 'early execute' it by flashloaning tokens, locking them, casting a YES vote to trigger early execution, unlocking tokens, and repaying the flashloan - all in one transaction. The vulnerable code is in LockToVotePlugin.vote() at lines 205-207 which calls _attemptEarlyExecution() when VotingMode.EarlyExecution is set.",
  "fix_description": "Avoid allowing the early execution in the very same block that the vote has been made. This would require tracking the 'success' of a proposal in a separate flag, stored in the proposal struct. Alternatively, remove the EarlyExecution voting mode entirely.",
  "source_reference": "https://github.com/spearbit/portfolio/blob/master/pdfs/Aragon-Spearbit-Security-Review-July-2025.pdf",
  "external_references": [
    "https://github.com/aragon/lock-to-vote-plugin/tree/b3c5503c"
  ],
  "tags": [
    "flash_loan",
    "spearbit",
    "gold_standard",
    "audit_finding"
  ],
  "variant_type": "original",
  "variant_parent_id": null,
  "notes": "When EarlyExecution voting mode is enabled (VotingMode enum value 1), proposals can be executed as soon as they mathematically cannot fail. The vote() function at lines 205-207 calls _attemptEarlyExecution() which can execute the proposal in the same transaction as the vote. An attacker can flashloan tokens, lock them, vote YES to trigger early execution, then unlock and repay - all atomically.",
  "contract_file": "contracts/gs_012.sol",
  "subset": "annotated",
  "original_subset": "gold_standard"
}