{
  "id": "gs_044",
  "original_id": "gs_cantina_beets_001",
  "source_dataset": "gold_standard",
  "vulnerability_type": "repeated_arbitrage_extraction",
  "severity": "medium",
  "difficulty_tier": 3,
  "context_level": "single_file",
  "is_vulnerable": true,
  "finding_title": "UNWIND_ROLE Can Extract Profit via Repeated allowedUnwindSlippagePercent Arbitrage",
  "finding_description": "The unwind function is used when the protocol leverage in the underlying AAVE pool needs to be reduced when it is no longer profitable. An actor with UNWIND_ROLE exchanges LST for WETH and repays the protocol to lower leverage. The role can act freely and unwind beyond the target healthFactor up until the underlying AAVE pool allows, then repay WETH. The vault uses the LST's convertToAsset ratio as a reference price and applies allowedUnwindSlippagePercent, which permits the UNWIND_ROLE to return slightly less WETH when exchanging LST in external markets.",
  "vulnerable_lines": [],
  "vulnerable_functions": [],
  "has_context": true,
  "fix_description": "Implement health factor margin constraints on unwind operations to cap the leverage reduction that can be performed and prevent the unwind result from exceeding the target health factor.",
  "expert_notes": "This is a profitable extraction attack enabled by access control and economic incentive misalignment. Key observations: (1) The UNWIND_ROLE is trusted with unilateral leverage control but not trusted with profit extraction\u2014yet the design allows both, (2) The slippage tolerance is calibrated for a single execution, not repeated loops, (3) The unwind\u2192deposit\u2192withdraw cycle allows resetting vault state indefinitely, (4) Market dependence: if external LST price remains > (vault_price * (1 - slippage)), the attack is infinitely repeatable. Beets' fix adds health factor margin requirements (unwind can only occur if HF <= target - MARGIN, and cannot end with HF > target), capping damage to the margin delta rather than blocking arbitrage entirely.",
  "context_hint": "The vulnerability exploits the slippage tolerance mechanism designed for legitimate market execution. The allowedUnwindSlippagePercent is meant to permit reasonable price differences during exchange, but if external markets price LST higher than the vault's convertToAssets reference price, the margin becomes an arbitrage opportunity. The critical issue is that unwind has no hard requirement to reduce leverage to a target healthFactor\u2014the UNWIND_ROLE can unwind freely as long as AAVE's pool constraints allow, then deposits reset the vault for another loop.",
  "call_flow": [
    "1. UNWIND_ROLE observes LST market price > vault convertToAssets price + allowedUnwindSlippagePercent",
    "2. Attacker receives LST via unwind(lstAmount, minWethOut)",
    "3. Attacker exchanges LST on external market at premium rate (above vault pricing)",
    "4. Attacker returns WETH at minimum amount allowed by slippage tolerance",
    "5. Difference between actual exchange rate and minimum allowed becomes attacker profit",
    "6. Vault debt reduced, but healthFactor not required to reach target",
    "7. Attacker (or external user) deposits WETH back into vault",
    "8. Deposit callback rebalances vault, increasing healthFactor",
    "9. Deposits reset vault to enable another unwind with fresh LST collateral",
    "10. Loop repeats: unwind \u2192 exchange at premium \u2192 deposit \u2192 withdraw",
    "11. Process continues until external market rate collapses or vault is depleted",
    "12. PoC demonstrates 17 ETH extraction from 100 ETH vault (17% loss) over 300 iterations"
  ]
}