{
  "id": "gs_012",
  "original_id": "gs_spearbit_aragon-lock-to-vote_H02",
  "source_dataset": "gold_standard",
  "source_file": "aragon.json",
  "language": "solidity",
  "chain": "ethereum",
  "source_platform": "spearbit",
  "source_report": "Aragon DAO Gov Plugin Security Review",
  "source_finding_id": "H-02",
  "report_url": "https://github.com/spearbit/portfolio/blob/master/pdfs/Aragon-Spearbit-Security-Review-July-2025.pdf",
  "github_repo_url": "https://github.com/aragon/lock-to-vote-plugin/tree/b3c5503c",
  "contest_date": "2025-09-11",
  "vulnerability_type": "flash_loan",
  "severity": "high",
  "difficulty_tier": 3,
  "context_level": "multi_file",
  "is_vulnerable": true,
  "finding_title": "Proposals created with voting mode EarlyExecution are vulnerable to flashloan attacks",
  "finding_description": "If the token used by the LockManager can be flashloaned (or flashminted) and a proposal is created with the voting mode EarlyExecution, anyone could be able to 'early execute' it by flashloaning tokens, locking them, casting a YES vote to trigger early execution, unlocking tokens, and repaying the flashloan - all in one transaction. The vulnerable code is in LockToVotePlugin.vote() at lines 205-207 which calls _attemptEarlyExecution() when VotingMode.EarlyExecution is set.",
  "attack_scenario": "1. Flashloan the needed amount.\n2. Lock the flashloaned amount via LockManager.lock().\n3. Cast a 'YES' vote via LockManager.vote() which triggers LockToVotePlugin._attemptEarlyExecution().\n4. Proposal executes immediately in same transaction.\n5. Unlock the tokens via LockManager.unlock().\n6. Repay the flashloan.",
  "fix_description": "Avoid allowing the early execution in the very same block that the vote has been made. This would require tracking the 'success' of a proposal in a separate flag, stored in the proposal struct. Alternatively, remove the EarlyExecution voting mode entirely.",
  "call_flow": "Attacker.flashloan() -> LockManager.lockAndVote() -> LockToVotePlugin.vote() -> lines 205-207: if EarlyExecution mode -> _attemptEarlyExecution() -> _canExecute() -> _execute() -> LockManager.unlock() -> repay flashloan",
  "context_hint": "When EarlyExecution voting mode is enabled (VotingMode enum value 1), proposals can be executed as soon as they mathematically cannot fail. The vote() function at lines 205-207 calls _attemptEarlyExecution() which can execute the proposal in the same transaction as the vote. An attacker can flashloan tokens, lock them, vote YES to trigger early execution, then unlock and repay - all atomically.",
  "primary_file_path": "src/LockToVotePlugin.sol",
  "vulnerable_lines": [
    145,
    146,
    147,
    148,
    149,
    150,
    151,
    152,
    153,
    154,
    155,
    156,
    157,
    158,
    159,
    160,
    161,
    162,
    163,
    164,
    165,
    166,
    167,
    168,
    169,
    170,
    171,
    172,
    173,
    174,
    175,
    176,
    177,
    178,
    179,
    180,
    181,
    182,
    183,
    184,
    185,
    186,
    187,
    188,
    189,
    190,
    191,
    192,
    193,
    194,
    195,
    196,
    197,
    198,
    199,
    200,
    201,
    202,
    203,
    204,
    205,
    206,
    207,
    208,
    302,
    303,
    304,
    305,
    306,
    307,
    308,
    309,
    310
  ],
  "vulnerable_functions": [
    "vote",
    "_attemptEarlyExecution"
  ],
  "context_files": [
    {
      "filename": "context_01_LockManagerBase.sol",
      "original_path": "src/base/LockManagerBase.sol",
      "relevance": "Provides lockAndVote() function (lines 84-101) that allows locking and voting in one call, enabling the flashloan attack vector."
    },
    {
      "filename": "context_02_MajorityVotingBase.sol",
      "original_path": "src/base/MajorityVotingBase.sol",
      "relevance": "Contains VotingMode enum (lines 139-143) including EarlyExecution mode which is the vulnerable configuration. Also contains _hasSucceeded() which checks isSupportThresholdReachedEarly()."
    }
  ],
  "has_context": true
}