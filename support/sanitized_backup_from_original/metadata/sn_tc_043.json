{
  "sample_id": "sn_tc_043",
  "exploit_name": "Seneca Protocol (Chamber)",
  "timestamp": "2024-02",
  "loss_amount_usd": 6400000,
  "blockchain": "ethereum",
  "vulnerability_type": "access_control",
  "sub_category": "arbitrary_call",
  "severity": "critical",
  "tags": [
    "vault",
    "arbitrary_call",
    "approval_exploit",
    "user_input_validation",
    "operations",
    "transferFrom"
  ],
  "difficulty": "advanced",
  "temporal_category": "pre_cutoff",
  "cutoff_date": "2024-02",
  "description": "Seneca Protocol's Chamber contract was exploited for $6.4M through its performOperations() function. The function accepted user-controlled target addresses and calldata, allowing attackers to call transferFrom() on tokens where victims had given approvals to Chamber.",
  "vulnerable_lines": [],
  "vulnerability_details": {
    "root_cause": "User-controlled target address and calldata in performOperations allowing arbitrary external calls",
    "attack_vector": "Craft operation with transferFrom calldata targeting victim tokens, execute via performOperations",
    "vulnerable_functions": [
      "performOperations()"
    ],
    "key_weakness": [
      "User-controlled target address",
      "User-controlled calldata without validation",
      "No whitelist of approved targets",
      "Arbitrary external calls allowed",
      "Users gave unlimited approvals",
      "No function selector validation",
      "Missing operation benefit validation"
    ]
  },
  "attack_flow": [
    "Identify victim with Pendle Principal Token approval to Chamber",
    "Craft malicious operation data with OPERATION_CALL action",
    "Set target = PendlePrincipalToken contract address",
    "Set callData = transferFrom(victim, attacker, victimBalance)",
    "Encode data = abi.encode(target, callData, 0, 0, 0)",
    "Call chamber.performOperations(actions, values, datas)",
    "Chamber decodes target and callData from user input",
    "Chamber executes: target.call(callData)",
    "Token contract processes transferFrom with Chamber as msg.sender",
    "Transfer succeeds because victim approved Chamber",
    "Attacker receives victim's entire token balance",
    "Repeat for multiple victims with approvals",
    "Total stolen: $6.4M in Pendle tokens"
  ],
  "mitigation": [
    "Whitelist allowed target contract addresses",
    "Whitelist allowed function selectors",
    "Never allow transferFrom calls on arbitrary tokens",
    "Validate operations only affect caller's assets",
    "Implement approval scoping (Permit2)",
    "Add operation type restrictions per role",
    "Require explicit confirmation for transfers",
    "Monitor for suspicious patterns",
    "Add maximum transfer limits per operation"
  ],
  "references": [
    "https://twitter.com/Phalcon_xyz/status/1763045563040411876",
    "https://etherscan.io/address/0x65c210c59B43EB68112b7a4f75C8393C36491F06"
  ],
  "contract_file": "contracts/sn_tc_043.sol",
  "subset": "annotated",
  "original_subset": "temporal_contamination",
  "variant_type": "sanitized",
  "variant_parent_id": "tc_043",
  "transformation": {
    "type": "full_sanitization",
    "source_dir": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original",
    "source_contract": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/contracts/tc_043.sol",
    "source_metadata": "/Users/poamen/projects/grace/blockbench/base/dataset/temporal_contamination/original/metadata/tc_043.json",
    "script": "strategies/sanitize/sanitize_originals.py",
    "changes": [
      "Removed comment: Pendle...",
      "Removed comment: SENECA...",
      "Removed comment: Seneca...",
      "Removed comment: VULNERABILITY...",
      "Removed comment: VULNERABILITY...",
      "Removed comment: VULNERABILITY...",
      "Removed comment: VULNERABILITY...",
      "Removed comment: // Attacker can encode transferFrom() calls...",
      "Removed block comment with vulnerability hint",
      "Removed block comment with vulnerability hint",
      "Removed block comment with vulnerability hint",
      "Renamed: SenecaChamber \u2192 CDPChamber",
      "WARNING: Built-in msg.sender count changed: 3 -> 1",
      "WARNING: Built-in abi.encode count changed: 2 -> 0",
      "WARNING: Built-in abi.encodeWithSignature count changed: 1 -> 0"
    ],
    "contract_renames": {
      "SenecaChamber": "CDPChamber"
    },
    "created_date": "2025-12-29T22:32:45.445398"
  }
}