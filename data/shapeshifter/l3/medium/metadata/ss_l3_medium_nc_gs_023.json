{
  "id": "ss_l3_medium_nc_gs_023",
  "contract_file": "contracts/ss_l3_medium_nc_gs_023.sol",
  "subset": "shapeshifter",
  "ground_truth": {
    "is_vulnerable": true,
    "vulnerability_type": "logic_error",
    "severity": "medium",
    "vulnerable_location": {
      "contract_name": "LiquidityBuffer",
      "function_name": "_0x167282",
      "line_numbers": []
    },
    "root_cause": "Staking.allocateETH() forwards ETH to LiquidityBuffer.depositETH(), which auto-allocates to defaultManagerId when shouldExecuteAllocation is true. If the current default manager is deactivated via LiquidityBuffer.updatePositionManager()/togglePositionManagerStatus() without first switching defaultManagerId or disabling auto-allocation, _allocateETHToManager(defaultManagerId, \u2026) reverts with LiquidityBuffer__ManagerInactive(). This can unexpectedly block allocation flows.",
    "attack_vector": "1. Admin sets defaultManagerId to manager 0 with shouldExecuteAllocation = true\n2. Admin calls togglePositionManagerStatus(0) to deactivate the default manager\n3. User calls Staking.allocateETH() which forwards to LiquidityBuffer.depositETH()\n4. depositETH() calls _allocateETHToManager(defaultManagerId, msg.value)\n5. _allocateETHToManager reverts with LiquidityBuffer__ManagerInactive() because the default manager is inactive\n6. All allocation flows are blocked until admin either reactivates the manager or changes defaultManagerId",
    "impact": "Severity: medium",
    "correct_fix": "Prevent deactivation of the current defaultManagerId while auto-allocation is enabled: require shouldExecuteAllocation == false or switch defaultManagerId to an active manager before deactivation."
  },
  "provenance": {
    "source": "mixbytes",
    "original_id": "gs_mixbytes_mantle-meth-aave_M01",
    "url": "https://github.com/mixbytes/audits_public/tree/master/Mantle%20Network/mETH%20x%20Aave%20Integration",
    "date_discovered": "2025-10-22",
    "date_added": "2025-12-16",
    "added_by": "benchmark_team"
  },
  "code_metadata": {
    "solidity_version": "^0.8.0",
    "num_lines": 571,
    "num_contracts": 1,
    "contract_names": [],
    "num_functions": 0,
    "has_imports": false,
    "imports": [],
    "has_inheritance": false,
    "inherits_from": [],
    "has_modifiers": false,
    "has_events": false,
    "has_assembly": false,
    "compilation_verified": false,
    "compiler_version_used": null
  },
  "tags": [
    "logic_error",
    "mixbytes",
    "gold_standard",
    "audit_finding"
  ],
  "notes": "The depositETH function auto-allocates to the default manager when shouldExecuteAllocation is true, but updatePositionManager and togglePositionManagerStatus can deactivate the default manager without any check, causing subsequent depositETH calls to revert.",
  "gold_standard_fields": {
    "source_report": "Mantle mETH x Aave Integration Security Audit",
    "source_finding_id": "M-1",
    "finding_title": "Default manager deactivation in LiquidityBuffer can break auto-allocation",
    "difficulty_tier": 2,
    "context_level": "single_file",
    "has_context": false,
    "call_flow": "Staking.allocateETH() -> LiquidityBuffer.depositETH() -> _allocateETHToManager(defaultManagerId) -> reverts if defaultManager.isActive == false"
  },
  "evaluation_support": {
    "annotated_contract": "labelled_data/gold_standard/contracts/gs_023.sol",
    "detailed_metadata": "labelled_data/gold_standard/metadata/gs_023.json",
    "original_finding_title": "Default manager deactivation in LiquidityBuffer can break auto-allocation"
  },
  "original_subset": "gold_standard",
  "original_contract_file": "base/contracts/gs_023.sol",
  "sanitized_from": "gs_023",
  "derived_from": "nc_gs_023",
  "original_id": "gs_023",
  "identifier_mappings": {
    "_topUpInterestToStakingAndCollectFees": "_0x7ef6e1",
    "receiveReturnsFromLiquidityBuffer": "_0x39e313",
    "receiveETHFromPositionManager": "_0x509389",
    "togglePositionManagerStatus": "_0xa18188",
    "onlyPositionManagerContract": "_0x2cc7eb",
    "setShouldExecuteAllocation": "_0x914f1e",
    "interestClaimedFromManager": "_0xeb890d",
    "_BASIS_POINTS_DENOMINATOR": "_0xabad26",
    "_claimInterestFromManager": "_0xe9a489",
    "claimInterestFromManager": "_0x5c73bd",
    "shouldExecuteAllocation": "_0xd3ebd9",
    "isLiquidityBufferPaused": "_0x205df8",
    "totalAllocationCapacity": "_0xc75283",
    "_withdrawETHFromManager": "_0x214e8e",
    "withdrawETHFromManager": "_0xfc671f",
    "_receiveETHFromStaking": "_0xeefffb",
    "positionManagerConfigs": "_0x14d30d",
    "topUpInterestToStaking": "_0x9ce7e7",
    "_allocateETHToManager": "_0x8b27a5",
    "totalAllocatedBalance": "_0x52a6d5",
    "totalInterestToppedUp": "_0xbd89b6",
    "setCumulativeDrawdown": "_0xa27e17",
    "claimInterestAndTopUp": "_0xb41e32",
    "updatePositionManager": "_0x167282",
    "getUnderlyingBalance": "_0x99ec5e",
    "getControlledBalance": "_0x964c49",
    "allocateETHToManager": "_0x445c0b",
    "getAvailableCapacity": "_0xcad022",
    "totalInterestClaimed": "_0x2a1cda",
    "_disableInitializers": "_0x8f8b98",
    "positionManagerCount": "_0x8036ae",
    "getAvailableBalance": "_0x931dc5",
    "_returnETHToStaking": "_0xd4df3e",
    "setDefaultManagerId": "_0x6ee213",
    "newDefaultManagerId": "_0xaba0c4",
    "isRegisteredManager": "_0x8960bb",
    "onlyStakingContract": "_0xaa17d2",
    "positionAccountants": "_0x58c955",
    "totalFundsReturned": "_0xa943ea",
    "cumulativeDrawdown": "_0x20c61e",
    "returnETHToStaking": "_0x294578",
    "totalFeesCollected": "_0xb7c7d3",
    "totalFundsReceived": "_0x5d4b63",
    "addPositionManager": "_0xf3cd00",
    "executeAllocation": "_0xfa570b",
    "withdrawAndReturn": "_0xc8317b",
    "getInterestAmount": "_0xb5a959",
    "setFeeBasisPoints": "_0xdcc280",
    "allocatedBalance": "_0x73d1f0",
    "defaultManagerId": "_0xa96d0a",
    "liquidityManager": "_0xa3df5a",
    "pendingPrincipal": "_0x1e3688",
    "newAllocationCap": "_0xf2916a",
    "positionManager": "_0xbb1812",
    "setFeesReceiver": "_0xfe6604",
    "stakingContract": "_0x2a44ce",
    "feesBasisPoints": "_0x632822",
    "drawdownManager": "_0x3153f2",
    "pendingInterest": "_0x984a34",
    "notZeroAddress": "_0xedaf24",
    "managerBalance": "_0x7dbf41",
    "isValidManager": "_0xf7b42b",
    "interestAmount": "_0xe1cf99",
    "managerAddress": "_0x67100d",
    "drawdownAmount": "_0xc668b7",
    "currentBalance": "_0x7de6d7",
    "newBasisPoints": "_0x04679e",
    "allocationCap": "_0xb136a4",
    "interestTopUp": "_0xdd2d88",
    "feesReceiver": "_0xacc1a3",
    "totalBalance": "_0x4e7eee",
    "newReceiver": "_0x0dbacb",
    "initializer": "_0xe9c8f4",
    "topUpAmount": "_0x4882b9",
    "depositETH": "_0xd44ef3",
    "initialize": "_0xaf6096",
    "accounting": "_0x2767d9",
    "_grantRole": "_0xe02e49",
    "minAmount": "_0x085fb1",
    "sendValue": "_0x60122a",
    "managerId": "_0x5f7cd8",
    "keccak256": "_0x38eec4",
    "onlyRole": "_0xcfaa5b",
    "withdraw": "_0x1dcac8",
    "isActive": "_0x973bdf",
    "manager": "_0x879612",
    "staking": "_0x78fc4c",
    "deposit": "_0x4d3be0",
    "mulDiv": "_0xb1926d",
    "config": "_0x3553f9",
    "amount": "_0x869d47",
    "pauser": "_0x2b5bb3",
    "encode": "_0x6c435d",
    "topUp": "_0x8dd2f0",
    "admin": "_0x0f8136",
    "init": "_0x1d6e4c",
    "addr": "_0xc77df4",
    "fees": "_0x4ea7b1"
  },
  "transformation": {
    "strategy": "shapeshifter",
    "level": "l3",
    "variant": "medium",
    "source": "nocomments",
    "changes": [
      "Renamed 98 identifiers using hex style",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional"
    ],
    "rename_map_size": 98,
    "metadata_changes": [
      "Transformed ground_truth.vulnerable_location.function_name: updatePositionManager \u2192 _0x167282"
    ]
  }
}