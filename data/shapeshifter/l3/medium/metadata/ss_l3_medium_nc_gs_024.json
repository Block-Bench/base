{
  "id": "ss_l3_medium_nc_gs_024",
  "contract_file": "contracts/ss_l3_medium_nc_gs_024.sol",
  "subset": "shapeshifter",
  "ground_truth": {
    "is_vulnerable": true,
    "vulnerability_type": "logic_error",
    "severity": "medium",
    "vulnerable_location": {
      "contract_name": "LiquidityBuffer",
      "function_name": "_0x95e555",
      "line_numbers": []
    },
    "root_cause": "LiquidityBuffer.getControlledBalance() sums balances of managers with isActive == true only. If an admin deactivates a manager via updatePositionManager()/togglePositionManagerStatus() before evacuating funds, any residual underlying on that manager is excluded from the total, causing under-reporting. Moreover, withdrawals from inactive managers are blocked (_withdrawETHFromManager and onlyPositionManagerContract both require the manager to be active), so the funds remain inaccessible until the manager is reactivated.",
    "attack_vector": "1. Position manager 0 has 1000 ETH allocated to it in Aave\n2. Admin calls togglePositionManagerStatus(0) to deactivate manager 0 without first withdrawing funds\n3. getControlledBalance() now returns a value that is 1000 ETH less than the actual protocol holdings\n4. _withdrawETHFromManager(0, amount) reverts with LiquidityBuffer__ManagerInactive()\n5. The 1000 ETH is effectively locked and invisible to the protocol accounting until admin reactivates the manager",
    "impact": "Severity: medium",
    "correct_fix": "Check underlying balance before deactivation and use a dedicated forceDeactivate() if it's not zero. This was fixed in commit 93280383c0858c559270ceaec6f5d04f9be0a8e7."
  },
  "provenance": {
    "source": "mixbytes",
    "original_id": "gs_mixbytes_mantle-meth-aave_M02",
    "url": "https://github.com/mixbytes/audits_public/tree/master/Mantle%20Network/mETH%20x%20Aave%20Integration",
    "date_discovered": "2025-10-22",
    "date_added": "2025-12-16",
    "added_by": "benchmark_team"
  },
  "code_metadata": {
    "solidity_version": "^0.8.0",
    "num_lines": 571,
    "num_contracts": 1,
    "contract_names": [],
    "num_functions": 0,
    "has_imports": false,
    "imports": [],
    "has_inheritance": false,
    "inherits_from": [],
    "has_modifiers": false,
    "has_events": false,
    "has_assembly": false,
    "compilation_verified": false,
    "compiler_version_used": null
  },
  "tags": [
    "logic_error",
    "mixbytes",
    "gold_standard",
    "audit_finding"
  ],
  "notes": "The getControlledBalance function only sums balances from active managers, but deactivation doesn't force fund evacuation first. This causes under-reporting of controlled funds and locks the funds since _withdrawETHFromManager requires the manager to be active.",
  "gold_standard_fields": {
    "source_report": "Mantle mETH x Aave Integration Security Audit",
    "source_finding_id": "M-2",
    "finding_title": "Inactive managers may under-report funds",
    "difficulty_tier": 2,
    "context_level": "single_file",
    "has_context": false,
    "call_flow": "getControlledBalance() loops through managers but skips inactive ones -> _withdrawETHFromManager() reverts for inactive managers -> funds locked until reactivation"
  },
  "evaluation_support": {
    "annotated_contract": "labelled_data/gold_standard/contracts/gs_024.sol",
    "detailed_metadata": "labelled_data/gold_standard/metadata/gs_024.json",
    "original_finding_title": "Inactive managers may under-report funds"
  },
  "original_subset": "gold_standard",
  "original_contract_file": "base/contracts/gs_024.sol",
  "sanitized_from": "gs_024",
  "derived_from": "nc_gs_024",
  "original_id": "gs_024",
  "identifier_mappings": {
    "_topUpInterestToStakingAndCollectFees": "_0x46630e",
    "receiveReturnsFromLiquidityBuffer": "_0x5b49a1",
    "receiveETHFromPositionManager": "_0xe2cc7c",
    "togglePositionManagerStatus": "_0x452b39",
    "onlyPositionManagerContract": "_0x885bc0",
    "setShouldExecuteAllocation": "_0x959b74",
    "interestClaimedFromManager": "_0xdb600e",
    "_BASIS_POINTS_DENOMINATOR": "_0x89610c",
    "_claimInterestFromManager": "_0x694cd7",
    "claimInterestFromManager": "_0xca64f9",
    "totalAllocationCapacity": "_0x89ab08",
    "_withdrawETHFromManager": "_0xa6e512",
    "shouldExecuteAllocation": "_0x9a0374",
    "isLiquidityBufferPaused": "_0x2149cd",
    "withdrawETHFromManager": "_0xf133c1",
    "positionManagerConfigs": "_0x2851c6",
    "topUpInterestToStaking": "_0x38c5ca",
    "_receiveETHFromStaking": "_0x89a933",
    "updatePositionManager": "_0xc2b61a",
    "setCumulativeDrawdown": "_0x6c67d2",
    "totalAllocatedBalance": "_0x4d3f2d",
    "_allocateETHToManager": "_0x5c79e3",
    "claimInterestAndTopUp": "_0x37a429",
    "totalInterestToppedUp": "_0x7912d5",
    "getUnderlyingBalance": "_0x871fd3",
    "_disableInitializers": "_0x531d41",
    "getAvailableCapacity": "_0x06f82a",
    "getControlledBalance": "_0x95e555",
    "totalInterestClaimed": "_0xddc464",
    "positionManagerCount": "_0xca39d4",
    "allocateETHToManager": "_0x162c32",
    "isRegisteredManager": "_0x72d86c",
    "getAvailableBalance": "_0x0d8f71",
    "_returnETHToStaking": "_0xf65f1f",
    "positionAccountants": "_0x26ad5d",
    "newDefaultManagerId": "_0xb1bfee",
    "setDefaultManagerId": "_0xb4063d",
    "onlyStakingContract": "_0xdf1442",
    "cumulativeDrawdown": "_0x8a9236",
    "totalFeesCollected": "_0x22114a",
    "totalFundsReturned": "_0xb0159c",
    "addPositionManager": "_0x85c3e9",
    "totalFundsReceived": "_0x79709a",
    "returnETHToStaking": "_0xd7af40",
    "getInterestAmount": "_0x1c6bf7",
    "executeAllocation": "_0x98875e",
    "withdrawAndReturn": "_0x19c2c0",
    "setFeeBasisPoints": "_0xbff33f",
    "newAllocationCap": "_0xb6a368",
    "allocatedBalance": "_0xdf5412",
    "defaultManagerId": "_0xd20277",
    "liquidityManager": "_0x3883c3",
    "pendingPrincipal": "_0x09a902",
    "stakingContract": "_0x92200d",
    "drawdownManager": "_0x6621a5",
    "feesBasisPoints": "_0x536880",
    "setFeesReceiver": "_0x6a5f82",
    "pendingInterest": "_0xca359c",
    "positionManager": "_0xce50c7",
    "managerBalance": "_0x276286",
    "isValidManager": "_0xb940ce",
    "notZeroAddress": "_0x52ea80",
    "drawdownAmount": "_0xb7a95d",
    "managerAddress": "_0xd9f53c",
    "currentBalance": "_0x43d3fe",
    "newBasisPoints": "_0x800e8f",
    "interestAmount": "_0x215973",
    "interestTopUp": "_0x38a744",
    "allocationCap": "_0x3baa68",
    "totalBalance": "_0xbb6b7e",
    "feesReceiver": "_0x9a6037",
    "topUpAmount": "_0xf8a6a1",
    "newReceiver": "_0x3eeca3",
    "initializer": "_0x3e714f",
    "_grantRole": "_0xa9f3a8",
    "initialize": "_0x1b8647",
    "depositETH": "_0x6735ce",
    "accounting": "_0x16717a",
    "managerId": "_0x2d24ff",
    "keccak256": "_0x9c7c16",
    "minAmount": "_0x2b08b0",
    "sendValue": "_0x165159",
    "withdraw": "_0x7c2f90",
    "onlyRole": "_0x890227",
    "isActive": "_0x078dfa",
    "manager": "_0x77a96b",
    "staking": "_0x002eed",
    "deposit": "_0xb34b5f",
    "pauser": "_0x5a3b7c",
    "config": "_0x157009",
    "amount": "_0x8c9252",
    "mulDiv": "_0x57c89e",
    "encode": "_0x034843",
    "admin": "_0x2cd11a",
    "topUp": "_0xdae166",
    "init": "_0x0dddc5",
    "fees": "_0x22a57f",
    "addr": "_0xa14fe1"
  },
  "transformation": {
    "strategy": "shapeshifter",
    "level": "l3",
    "variant": "medium",
    "source": "nocomments",
    "changes": [
      "Renamed 98 identifiers using hex style",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional",
      "Wrapped assignment in conditional"
    ],
    "rename_map_size": 98,
    "metadata_changes": [
      "Transformed ground_truth.vulnerable_location.function_name: getControlledBalance \u2192 _0x95e555"
    ]
  }
}