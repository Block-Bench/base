{
  "id": "sn_gs_023",
  "contract_file": "contracts/sn_gs_023.sol",
  "subset": "sanitized",
  "ground_truth": {
    "is_vulnerable": true,
    "vulnerability_type": "logic_error",
    "severity": "medium",
    "vulnerable_location": {
      "contract_name": "LiquidityBuffer",
      "function_name": "updatePositionManager",
      "line_numbers": [
        230,
        231,
        232,
        233,
        234,
        235,
        236,
        237,
        238,
        239,
        240,
        241,
        242,
        243,
        244,
        245,
        246,
        247,
        248,
        249,
        250,
        251,
        252,
        253,
        254,
        255,
        256,
        258,
        259,
        260,
        261,
        262,
        263,
        264,
        265,
        266,
        267,
        268,
        269,
        270,
        271,
        334,
        335,
        336,
        337,
        338,
        339,
        340
      ]
    },
    "root_cause": "Staking.allocateETH() forwards ETH to LiquidityBuffer.depositETH(), which auto-allocates to defaultManagerId when shouldExecuteAllocation is true. If the current default manager is deactivated via LiquidityBuffer.updatePositionManager()/togglePositionManagerStatus() without first switching defaultManagerId or disabling auto-allocation, _allocateETHToManager(defaultManagerId, \u2026) reverts with LiquidityBuffer__ManagerInactive(). This can unexpectedly block allocation flows.",
    "attack_vector": "1. Admin sets defaultManagerId to manager 0 with shouldExecuteAllocation = true\n2. Admin calls togglePositionManagerStatus(0) to deactivate the default manager\n3. User calls Staking.allocateETH() which forwards to LiquidityBuffer.depositETH()\n4. depositETH() calls _allocateETHToManager(defaultManagerId, msg.value)\n5. _allocateETHToManager reverts with LiquidityBuffer__ManagerInactive() because the default manager is inactive\n6. All allocation flows are blocked until admin either reactivates the manager or changes defaultManagerId",
    "impact": "Severity: medium",
    "correct_fix": "Prevent deactivation of the current defaultManagerId while auto-allocation is enabled: require shouldExecuteAllocation == false or switch defaultManagerId to an active manager before deactivation."
  },
  "provenance": {
    "source": "mixbytes",
    "original_id": "gs_mixbytes_mantle-meth-aave_M01",
    "url": "https://github.com/mixbytes/audits_public/tree/master/Mantle%20Network/mETH%20x%20Aave%20Integration",
    "date_discovered": "2025-10-22",
    "date_added": "2025-12-16",
    "added_by": "benchmark_team"
  },
  "code_metadata": {
    "solidity_version": "^0.8.0",
    "num_lines": 571,
    "num_contracts": 1,
    "contract_names": [],
    "num_functions": 0,
    "has_imports": false,
    "imports": [],
    "has_inheritance": false,
    "inherits_from": [],
    "has_modifiers": false,
    "has_events": false,
    "has_assembly": false,
    "compilation_verified": false,
    "compiler_version_used": null
  },
  "tags": [
    "logic_error",
    "mixbytes",
    "gold_standard",
    "audit_finding"
  ],
  "notes": "The depositETH function auto-allocates to the default manager when shouldExecuteAllocation is true, but updatePositionManager and togglePositionManagerStatus can deactivate the default manager without any check, causing subsequent depositETH calls to revert.",
  "gold_standard_fields": {
    "source_report": "Mantle mETH x Aave Integration Security Audit",
    "source_finding_id": "M-1",
    "finding_title": "Default manager deactivation in LiquidityBuffer can break auto-allocation",
    "difficulty_tier": 2,
    "context_level": "single_file",
    "has_context": false,
    "call_flow": "Staking.allocateETH() -> LiquidityBuffer.depositETH() -> _allocateETHToManager(defaultManagerId) -> reverts if defaultManager.isActive == false"
  },
  "evaluation_support": {
    "annotated_contract": "labelled_data/gold_standard/contracts/gs_023.sol",
    "detailed_metadata": "labelled_data/gold_standard/metadata/gs_023.json",
    "original_finding_title": "Default manager deactivation in LiquidityBuffer can break auto-allocation"
  },
  "original_subset": "gold_standard",
  "original_contract_file": "base/contracts/gs_023.sol",
  "sanitized_from": "gs_023"
}