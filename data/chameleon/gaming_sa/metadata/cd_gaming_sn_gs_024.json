{
  "id": "cd_gaming_sn_gs_024",
  "contract_file": "contracts/cd_gaming_sn_gs_024.sol",
  "subset": "crossdomain",
  "ground_truth": {
    "is_vulnerable": true,
    "vulnerability_type": "logic_error",
    "severity": "medium",
    "vulnerable_location": {
      "contract_name": "LiquidityBuffer",
      "function_name": "getControlledBalance",
      "line_numbers": [
        183,
        184,
        185,
        186,
        187,
        188,
        189,
        190,
        191,
        192,
        193,
        194,
        195,
        196,
        197,
        198,
        199,
        441,
        442,
        443,
        444,
        445,
        446,
        447,
        545,
        546,
        547,
        548,
        549,
        550,
        551,
        552,
        553,
        554,
        555,
        556,
        557,
        558,
        559,
        560,
        561,
        562
      ]
    },
    "root_cause": "LiquidityBuffer.getControlledBalance() sums balances of managers with isActive == true only. If an admin deactivates a manager via updatePositionManager()/togglePositionManagerStatus() before evacuating funds, any residual underlying on that manager is excluded from the total, causing under-reporting. Moreover, withdrawals from inactive managers are blocked (_withdrawETHFromManager and onlyPositionManagerContract both require the manager to be active), so the funds remain inaccessible until the manager is reactivated.",
    "attack_vector": "1. Position manager 0 has 1000 ETH allocated to it in Aave\n2. Admin calls togglePositionManagerStatus(0) to deactivate manager 0 without first withdrawing funds\n3. getControlledBalance() now returns a value that is 1000 ETH less than the actual protocol holdings\n4. _withdrawETHFromManager(0, amount) reverts with LiquidityBuffer__ManagerInactive()\n5. The 1000 ETH is effectively locked and invisible to the protocol accounting until admin reactivates the manager",
    "impact": "Severity: medium",
    "correct_fix": "Check underlying balance before deactivation and use a dedicated forceDeactivate() if it's not zero. This was fixed in commit 93280383c0858c559270ceaec6f5d04f9be0a8e7."
  },
  "provenance": {
    "source": "mixbytes",
    "original_id": "gs_mixbytes_mantle-meth-aave_M02",
    "url": "https://github.com/mixbytes/audits_public/tree/master/Mantle%20Network/mETH%20x%20Aave%20Integration",
    "date_discovered": "2025-10-22",
    "date_added": "2025-12-16",
    "added_by": "benchmark_team"
  },
  "code_metadata": {
    "solidity_version": "^0.8.0",
    "num_lines": 571,
    "num_contracts": 1,
    "contract_names": [],
    "num_functions": 0,
    "has_imports": false,
    "imports": [],
    "has_inheritance": false,
    "inherits_from": [],
    "has_modifiers": false,
    "has_events": false,
    "has_assembly": false,
    "compilation_verified": false,
    "compiler_version_used": null
  },
  "tags": [
    "logic_error",
    "mixbytes",
    "gold_standard",
    "audit_finding"
  ],
  "notes": "The getControlledBalance function only sums balances from active managers, but deactivation doesn't force fund evacuation first. This causes under-reporting of controlled funds and locks the funds since _withdrawETHFromManager requires the manager to be active.",
  "gold_standard_fields": {
    "source_report": "Mantle mETH x Aave Integration Security Audit",
    "source_finding_id": "M-2",
    "finding_title": "Inactive managers may under-report funds",
    "difficulty_tier": 2,
    "context_level": "single_file",
    "has_context": false,
    "call_flow": "getControlledBalance() loops through managers but skips inactive ones -> _withdrawETHFromManager() reverts for inactive managers -> funds locked until reactivation"
  },
  "evaluation_support": {
    "annotated_contract": "labelled_data/gold_standard/contracts/gs_024.sol",
    "detailed_metadata": "labelled_data/gold_standard/metadata/gs_024.json",
    "original_finding_title": "Inactive managers may under-report funds"
  },
  "original_subset": "gold_standard",
  "original_contract_file": "base/contracts/gs_024.sol",
  "sanitized_from": "gs_024",
  "derived_from": "sn_gs_024",
  "transformation": {
    "strategy": "cross_domain",
    "source_domain": "defi",
    "target_domain": "gaming",
    "coverage": 0.31,
    "identifiers_transformed": 44,
    "rename_map": {
      "ILiquidityBuffer": "ITradableassetsBuffer",
      "IStakingReturnsWrite": "IStakearenaReturnsWrite",
      "LiquidityBufferEvents": "FreeitemsBufferEvents",
      "ETHReturnedToStaking": "EthReturnedToWagersystem",
      "ETHReceivedFromStaking": "EthReceivedFromWagersystem",
      "InterestClaimed": "YieldbonusClaimed",
      "interestAmount": "stackingbonusAmount",
      "InterestToppedUp": "YieldbonusToppedUp",
      "LiquidityBuffer": "AvailablegoldBuffer",
      "LIQUIDITY_MANAGER_ROLE": "availablegold_manager_role",
      "INTEREST_TOPUP_ROLE": "yieldbonus_topup_role",
      "stakingContract": "wagersystemContract",
      "totalAllocatedBalance": "totalAllocatedTreasurecount",
      "totalInterestClaimed": "totalBonusrateClaimed",
      "totalInterestToppedUp": "totalYieldbonusToppedUp",
      "pendingInterest": "pendingStackingbonus",
      "admin": "serverOp",
      "liquidityManager": "freeitemsManager",
      "interestTopUp": "yieldbonusTopUp",
      "staking": "wagerSystem",
      "DEFAULT_ADMIN_ROLE": "default_serverop_role",
      "getInterestAmount": "getStackingbonusAmount",
      "currentBalance": "currentTreasurecount",
      "getUnderlyingBalance": "getUnderlyingItemcount",
      "allocatedBalance": "allocatedItemcount",
      "getAvailableBalance": "getAvailableGemtotal",
      "getControlledBalance": "getControlledLootbalance",
      "totalBalance": "totalItemcount",
      "balance": "goldHolding",
      "managerBalance": "managerGoldholding",
      "interestClaimedFromManager": "bonusrateClaimedFromManager",
      "setFeeBasisPoints": "setServicefeeBasisPoints",
      "depositETH": "storelootEth",
      "isLiquidityBufferPaused": "isAvailablegoldBufferPaused",
      "withdrawAndReturn": "claimlootAndReturn",
      "withdrawETHFromManager": "retrieveitemsEthFromManager",
      "returnETHToStaking": "returnEthToBettingpool",
      "claimInterestFromManager": "collectrewardStackingbonusFromManager",
      "topUpInterestToStaking": "topUpBonusrateToStakearena",
      "claimInterestAndTopUp": "earnpointsStackingbonusAndTopUp",
      "withdraw": "retrieveItems",
      "receiveReturnsFromLiquidityBuffer": "receiveReturnsFromFreeitemsBuffer",
      "deposit": "cacheTreasure",
      "onlyStakingContract": "onlyBettingpoolContract"
    }
  }
}