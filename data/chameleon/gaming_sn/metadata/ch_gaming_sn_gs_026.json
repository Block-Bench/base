{
  "id": "ch_gaming_sn_gs_026",
  "contract_file": "contracts/ch_gaming_sn_gs_026.sol",
  "subset": "chameleon_gaming",
  "ground_truth": {
    "is_vulnerable": true,
    "vulnerability_type": "access_control",
    "severity": "medium",
    "vulnerable_location": {
      "contract_name": "PositionManager",
      "function_name": "emergencyTokenTransfer",
      "line_numbers": [
        155,
        156,
        157,
        158,
        159,
        160,
        161,
        162,
        163,
        164
      ]
    },
    "root_cause": "EMERGENCY_ROLE in PositionManager can transfer aWETH from the contract to any address without restrictions, which may be unintended and creates additional risks in case this role is compromised. The emergencyTokenTransfer function allows unrestricted transfer of any ERC20 token, including aWETH which represents the protocol's position in Aave.",
    "attack_vector": "1. Attacker compromises the account holding EMERGENCY_ROLE\n2. Attacker calls emergencyTokenTransfer(aWETH, attackerAddress, aWETH.balanceOf(positionManager))\n3. All aWETH tokens (representing ETH deposited in Aave) are transferred to the attacker\n4. Protocol loses all funds deposited through this position manager\n5. The attack bypasses the normal withdraw() flow which goes through LiquidityBuffer",
    "impact": "Severity: medium",
    "correct_fix": "Disallow aWETH emergency transfers or approvals from the PositionManager contract, since withdrawals are already handled via the more transparent withdraw() flow. The team acknowledged this is intentional for rapid fund withdrawal in critical situations and noted EMERGENCY_ROLE will not be configured at launch."
  },
  "provenance": {
    "source": "mixbytes",
    "original_id": "gs_mixbytes_mantle-meth-aave_M04",
    "url": "https://github.com/mixbytes/audits_public/tree/master/Mantle%20Network/mETH%20x%20Aave%20Integration",
    "date_discovered": "2025-10-22",
    "date_added": "2025-12-16",
    "added_by": "benchmark_team"
  },
  "code_metadata": {
    "solidity_version": "^0.8.0",
    "num_lines": 199,
    "num_contracts": 1,
    "contract_names": [],
    "num_functions": 0,
    "has_imports": false,
    "imports": [],
    "has_inheritance": false,
    "inherits_from": [],
    "has_modifiers": false,
    "has_events": false,
    "has_assembly": false,
    "compilation_verified": false,
    "compiler_version_used": null
  },
  "tags": [
    "access_control",
    "mixbytes",
    "gold_standard",
    "audit_finding"
  ],
  "notes": "The emergencyTokenTransfer function allows the EMERGENCY_ROLE to transfer any ERC20 token including aWETH. This bypasses the normal withdraw flow and could be exploited if the emergency role is compromised.",
  "gold_standard_fields": {
    "source_report": "Mantle mETH x Aave Integration Security Audit",
    "source_finding_id": "M-4",
    "finding_title": "Emergency admin can transfer aWETH from the PositionManager",
    "difficulty_tier": 1,
    "context_level": "single_file",
    "has_context": false,
    "call_flow": "Compromised EMERGENCY_ROLE holder -> emergencyTokenTransfer(aWETH, attacker, balance) -> All protocol funds in Aave transferred to attacker"
  },
  "evaluation_support": {
    "annotated_contract": "labelled_data/gold_standard/contracts/gs_026.sol",
    "detailed_metadata": "labelled_data/gold_standard/metadata/gs_026.json",
    "original_finding_title": "Emergency admin can transfer aWETH from the PositionManager"
  },
  "original_subset": "gold_standard",
  "original_contract_file": "base/contracts/gs_026.sol",
  "sanitized_from": "gs_026",
  "transformation": {
    "strategy": "chameleon",
    "theme": "gaming",
    "source": "sanitized",
    "seed": 2467075125,
    "coverage": {
      "total_identifiers": 153,
      "transformed": 75,
      "untransformed": 78,
      "skipped_reserved": 54,
      "skipped_interface": 0,
      "coverage_percent": 49.02,
      "untransformed_details": [
        {
          "name": "SPDX",
          "reason": "no synonym found"
        },
        {
          "name": "License",
          "reason": "no synonym found"
        },
        {
          "name": "Identifier",
          "reason": "no synonym found"
        },
        {
          "name": "MIT",
          "reason": "no synonym found"
        },
        {
          "name": "Initializable",
          "reason": "no synonym found"
        },
        {
          "name": "openzeppelin",
          "reason": "no synonym found"
        },
        {
          "name": "upgradeable",
          "reason": "no synonym found"
        },
        {
          "name": "sol",
          "reason": "no synonym found"
        },
        {
          "name": "AccessControlEnumerableUpgradeable",
          "reason": "no synonym found"
        },
        {
          "name": "access",
          "reason": "no synonym found"
        },
        {
          "name": "SafeERC20",
          "reason": "no synonym found"
        },
        {
          "name": "ERC20",
          "reason": "no synonym found"
        },
        {
          "name": "IERC20",
          "reason": "no synonym found"
        },
        {
          "name": "IPool",
          "reason": "no synonym found"
        },
        {
          "name": "aave",
          "reason": "no synonym found"
        },
        {
          "name": "interfaces",
          "reason": "no synonym found"
        },
        {
          "name": "libraries",
          "reason": "no synonym found"
        },
        {
          "name": "IWETH",
          "reason": "no synonym found"
        },
        {
          "name": "title",
          "reason": "no synonym found"
        },
        {
          "name": "dev",
          "reason": "no synonym found"
        },
        {
          "name": "with",
          "reason": "no synonym found"
        },
        {
          "name": "role",
          "reason": "no synonym found"
        },
        {
          "name": "based",
          "reason": "no synonym found"
        },
        {
          "name": "control",
          "reason": "no synonym found"
        },
        {
          "name": "inspired",
          "reason": "no synonym found"
        },
        {
          "name": "Role",
          "reason": "no synonym found"
        },
        {
          "name": "definitions",
          "reason": "no synonym found"
        },
        {
          "name": "variables",
          "reason": "no synonym found"
        },
        {
          "name": "weth",
          "reason": "no synonym found"
        },
        {
          "name": "notice",
          "reason": "no synonym found"
        },
        {
          "name": "Configuration",
          "reason": "no synonym found"
        },
        {
          "name": "initialization",
          "reason": "no synonym found"
        },
        {
          "name": "Init",
          "reason": "no synonym found"
        },
        {
          "name": "init",
          "reason": "no synonym found"
        },
        {
          "name": "initializer",
          "reason": "no synonym found"
        },
        {
          "name": "__AccessControlEnumerable_init",
          "reason": "no synonym found"
        },
        {
          "name": "roles",
          "reason": "no synonym found"
        },
        {
          "name": "spend",
          "reason": "no synonym found"
        },
        {
          "name": "WETH",
          "reason": "no synonym found"
        },
        {
          "name": "referralCode",
          "reason": "no synonym found"
        },
        {
          "name": "onlyRole",
          "reason": "no synonym found"
        },
        {
          "name": "ETH",
          "reason": "no synonym found"
        },
        {
          "name": "into",
          "reason": "no synonym found"
        },
        {
          "name": "Invalid",
          "reason": "no synonym found"
        },
        {
          "name": "aWETH",
          "reason": "no synonym found"
        },
        {
          "name": "Insufficient",
          "reason": "no synonym found"
        },
        {
          "name": "via",
          "reason": "no synonym found"
        },
        {
          "name": "mode",
          "reason": "no synonym found"
        },
        {
          "name": "category",
          "reason": "no synonym found"
        },
        {
          "name": "addr",
          "reason": "no synonym found"
        },
        {
          "name": "wad",
          "reason": "no synonym found"
        },
        {
          "name": "Additional",
          "reason": "no synonym found"
        },
        {
          "name": "functions",
          "reason": "no synonym found"
        },
        {
          "name": "asset",
          "reason": "no synonym found"
        },
        {
          "name": "the",
          "reason": "no synonym found"
        },
        {
          "name": "utility",
          "reason": "no synonym found"
        },
        {
          "name": "recovery",
          "reason": "no synonym found"
        },
        {
          "name": "case",
          "reason": "no synonym found"
        },
        {
          "name": "stuck",
          "reason": "no synonym found"
        },
        {
          "name": "due",
          "reason": "no synonym found"
        },
        {
          "name": "direct",
          "reason": "no synonym found"
        },
        {
          "name": "transfers",
          "reason": "no synonym found"
        },
        {
          "name": "param",
          "reason": "no synonym found"
        },
        {
          "name": "native",
          "reason": "no synonym found"
        },
        {
          "name": "selfdestructs",
          "reason": "no synonym found"
        },
        {
          "name": "pre",
          "reason": "no synonym found"
        },
        {
          "name": "computed",
          "reason": "no synonym found"
        },
        {
          "name": "before",
          "reason": "no synonym found"
        },
        {
          "name": "deployment",
          "reason": "no synonym found"
        },
        {
          "name": "fails",
          "reason": "no synonym found"
        },
        {
          "name": "Only",
          "reason": "no synonym found"
        },
        {
          "name": "allowed",
          "reason": "no synonym found"
        },
        {
          "name": "here",
          "reason": "no synonym found"
        },
        {
          "name": "Prevent",
          "reason": "no synonym found"
        },
        {
          "name": "other",
          "reason": "no synonym found"
        },
        {
          "name": "addresses",
          "reason": "no synonym found"
        },
        {
          "name": "not",
          "reason": "no synonym found"
        },
        {
          "name": "calls",
          "reason": "no synonym found"
        }
      ],
      "meets_threshold": false
    },
    "rename_map": {
      "from": "origin",
      "proxy": "portalGate",
      "utils": "gameUtils",
      "token": "medal",
      "DataTypes": "InfoTypes",
      "protocol": "questSystem",
      "types": "gameTypes",
      "IPositionManager": "IPositionController",
      "ILiquidityBuffer": "IReservesBuffer",
      "liquidityBuffer": "reservesBuffer",
      "PositionManager": "PositionController",
      "Position": "Coordinates",
      "manager": "controller",
      "WrappedTokenGatewayV3": "WrappedCoinGatewayV3",
      "EXECUTOR_ROLE": "performer_role",
      "MANAGER_ROLE": "controller_role",
      "EMERGENCY_ROLE": "urgent_role",
      "State": "Status",
      "pool": "jackpotPool",
      "admin": "serverOp",
      "Events": "GameEvents",
      "Deposit": "DepositGold",
      "caller": "summoner",
      "amount": "count",
      "aTokenAmount": "aMedalTotal",
      "Withdraw": "RedeemTokens",
      "Borrow": "SeekAdvance",
      "rateMode": "multiplierMode",
      "Repay": "SettleDebt",
      "SetUserEMode": "CollectionPlayerEMode",
      "categoryId": "categoryIdentifier",
      "_disableInitializers": "_deactivateInitializers",
      "initialize": "beginQuest",
      "Set": "Assign",
      "_grantRole": "_bestowRole",
      "DEFAULT_ADMIN_ROLE": "default_serverop_role",
      "max": "ceiling",
      "Implementation": "Execution",
      "deposit": "addTreasure",
      "value": "worth",
      "Wrap": "Envelop",
      "sender": "invoker",
      "withdraw": "harvestGold",
      "Get": "Retrieve",
      "getReserveAToken": "fetchReserveACrystal",
      "userBalance": "adventurerRewardlevel",
      "amountToWithdraw": "totalDestinationCollectbounty",
      "Unwrap": "Unpack",
      "LiquidityBuffer": "ReservesBuffer",
      "receiveETHFromPositionManager": "acceptlootEthOriginPositionController",
      "getUnderlyingBalance": "obtainUnderlyingLootbalance",
      "setUserEMode": "collectionHeroEMode",
      "user": "player",
      "approveToken": "permitaccessMedal",
      "safeApprove": "safePermitaccess",
      "revokeToken": "cancelCoin",
      "helper": "questHelper",
      "getBorrowBalance": "obtainSeekadvancePrizecount",
      "debtToken": "owingGem",
      "getReserveVariableDebtToken": "obtainReserveVariableObligationCrystal",
      "getCollateralBalance": "retrievePledgeLootbalance",
      "getUserEMode": "retrievePlayerEMode",
      "setUserUseReserveAsCollateral": "groupCharacterUseReserveAsSecurity",
      "useAsCollateral": "useAsSecurity",
      "setLiquidityBuffer": "collectionFlowBuffer",
      "_liquidityBuffer": "_flowBuffer",
      "_revokeRole": "_cancelRole",
      "tokens": "coins",
      "recipient": "target",
      "emergencyTokenTransfer": "criticalCrystalSendloot",
      "safeTransfer": "secureMove",
      "emergencyEtherTransfer": "criticalEtherTradefunds",
      "_safeTransferETH": "_safeSendlootEth",
      "success": "win",
      "ETH_TRANSFER_FAILED": "eth_relocateassets_failed"
    }
  }
}