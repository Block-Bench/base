{
  "id": "ch_gaming_sn_gs_003",
  "contract_file": "contracts/ch_gaming_sn_gs_003.sol",
  "subset": "chameleon_gaming",
  "ground_truth": {
    "is_vulnerable": true,
    "vulnerability_type": "logic_error",
    "severity": "medium",
    "vulnerable_location": {
      "contract_name": "GaugeV2",
      "function_name": "emergencyWithdraw",
      "line_numbers": [
        270,
        271,
        272,
        273,
        274,
        275,
        276,
        277,
        278,
        279,
        280,
        281
      ]
    },
    "root_cause": "in the `GaugeV2` contract, if the contract was emergency activated, users calling `emergencyWithdraw()` will lose all past accrued rewards that didn\u2019t have `updateReward()` called on it previously for a user to earn rewards, he gets his mappings updated here modifier updateReward(address account) { rewardPerTokenStored = rewardPerToken(); lastUpdateTime = lastTimeRewardApplicable(); if (account != address(0)) { rewards[account] = earned(account); userRewardPerTokenPaid[account] = rewardPerTokenStored; } _; } as we see above, rewards mapping is registered as the return data from `earned()`, and when we look at it we see function earned(address account) public view returns (uint256) { rewards[account] + _balanceOf(account) * (rewardPerToken() - userRewardPerTokenPaid[account]) / 1e18; } we see that it returns old rewards + current balance of the user multiplied by the rewardPerToken (abstractly) so what happen will be as follows: 1. User stake 100e18 tokens 2. emergency activated 3. he had already earnt before the emergency 10e18 tokens not registered on his rewards mapping since he didn\u2019t call deposit/withdraw/getRewards to update his rewards 4. call emergencyWithdraw and his balance now is 0. 5. now earned() function return 0 rewards since his balance is 0 * rewardPerToken = 0 also the left-off rewards tokens are stuck in the contract forever. Impact: Loss of rewards for users and stuck reward tokens in the contract",
    "attack_vector": "function test_emergencyWithdraw_strandsRewardsAndBurnsUserAccrual() external { vm.startPrank(address(this)); // Use HYBR both as staking TOKEN and rewardToken for simplicity // We have HYBR minted to this test from setup_InitMinter() uint256 initialHybr = hybr.balanceOf(address(this)); assertGt(initialHybr, 0, \"expected HYBR from initial mint\"); // Deploy GaugeV2 GaugeV2 gauge = new GaugeV2( address(hybr), address(rewardHybr), address(votingEscrow), address(hybr), address(this), address(0), address(0), false ); // Stake HYBR uint256 stakeAmount = 100 ether; hybr.approve(address(gauge), type(uint256).max); gauge.deposit(stakeAmount); // Fund rewards uint256 rewardAmount = 1_000 ether; hybr.approve(address(gauge), rewardAmount); gauge.notifyRewardAmount(address(hybr), rewardAmount); // Accrue some rewards vm.warp(block.timestamp + 7 days / 14); uint256 accruedBefore = gauge.earned(address(this)); assertGt(accruedBefore, 0, \"accrued must be > 0 before emergencyWithdraw\"); // Enable emergency and withdraw gauge.activateEmergencyMode(); gauge.emergencyWithdraw(); uint256 accruedAfter = gauge.earned(address(this)); assertEq(accruedAfter, 0, \"accrued should be zero after emergencyWithdraw\"); uint256 stuckRewards = hybr.balanceOf(address(gauge)); assertGt(stuckRewards, 0, \"reward tokens remain stuck in gauge\"); vm.stopPrank(); }",
    "impact": "Severity: medium",
    "correct_fix": "Add the `updateReward` modifier to the `emergencyWithdraw()` call"
  },
  "provenance": {
    "source": "code4rena",
    "original_id": "gs_c4_2025-10-hybra-finance_M02",
    "url": "https://code4rena.com/reports/2025-10-hybra-finance",
    "date_discovered": "2025-10-06",
    "date_added": "2025-12-16",
    "added_by": "benchmark_team"
  },
  "code_metadata": {
    "solidity_version": "^0.8.0",
    "num_lines": 410,
    "num_contracts": 1,
    "contract_names": [],
    "num_functions": 0,
    "has_imports": false,
    "imports": [],
    "has_inheritance": false,
    "inherits_from": [],
    "has_modifiers": false,
    "has_events": false,
    "has_assembly": false,
    "compilation_verified": false,
    "compiler_version_used": null
  },
  "tags": [
    "logic_error",
    "code4rena",
    "gold_standard",
    "audit_finding"
  ],
  "notes": "Emergency withdraw skips reward update, burning unclaimed rewards and leaving tokens stuck in the gauge.",
  "gold_standard_fields": {
    "source_report": "2025-10-hybra-finance",
    "source_finding_id": "M-02",
    "finding_title": "Users emergency withdrawing will lose all past accrued rewards",
    "difficulty_tier": 2,
    "context_level": "single_file",
    "has_context": false,
    "call_flow": "User.deposit() -> notifyRewardAmount() -> warp time -> activateEmergencyMode() -> emergencyWithdraw() -> earned() returns 0"
  },
  "evaluation_support": {
    "annotated_contract": "labelled_data/gold_standard/contracts/gs_003.sol",
    "detailed_metadata": "labelled_data/gold_standard/metadata/gs_003.json",
    "original_finding_title": "Users emergency withdrawing will lose all past accrued rewards"
  },
  "original_subset": "gold_standard",
  "original_contract_file": "base/contracts/gs_003.sol",
  "sanitized_from": "gs_003",
  "transformation": {
    "strategy": "chameleon",
    "theme": "gaming",
    "source": "sanitized",
    "seed": 1542729161,
    "coverage": {
      "total_identifiers": 179,
      "transformed": 84,
      "untransformed": 95,
      "skipped_reserved": 44,
      "skipped_interface": 0,
      "coverage_percent": 46.93,
      "untransformed_details": [
        {
          "name": "SPDX",
          "reason": "no synonym found"
        },
        {
          "name": "License",
          "reason": "no synonym found"
        },
        {
          "name": "Identifier",
          "reason": "no synonym found"
        },
        {
          "name": "MIT",
          "reason": "no synonym found"
        },
        {
          "name": "openzeppelin",
          "reason": "no synonym found"
        },
        {
          "name": "contracts",
          "reason": "no synonym found"
        },
        {
          "name": "security",
          "reason": "no synonym found"
        },
        {
          "name": "ReentrancyGuard",
          "reason": "no synonym found"
        },
        {
          "name": "sol",
          "reason": "no synonym found"
        },
        {
          "name": "access",
          "reason": "no synonym found"
        },
        {
          "name": "Ownable",
          "reason": "no synonym found"
        },
        {
          "name": "ERC20",
          "reason": "no synonym found"
        },
        {
          "name": "SafeERC20",
          "reason": "no synonym found"
        },
        {
          "name": "IERC20",
          "reason": "no synonym found"
        },
        {
          "name": "interfaces",
          "reason": "no synonym found"
        },
        {
          "name": "IBribe",
          "reason": "no synonym found"
        },
        {
          "name": "libraries",
          "reason": "no synonym found"
        },
        {
          "name": "Math",
          "reason": "no synonym found"
        },
        {
          "name": "IRHYBR",
          "reason": "no synonym found"
        },
        {
          "name": "IRewarder",
          "reason": "no synonym found"
        },
        {
          "name": "GaugeV2",
          "reason": "no synonym found"
        },
        {
          "name": "rHYBR",
          "reason": "no synonym found"
        },
        {
          "name": "DISTRIBUTION",
          "reason": "no synonym found"
        },
        {
          "name": "gaugeRewarder",
          "reason": "no synonym found"
        },
        {
          "name": "internal_bribe",
          "reason": "no synonym found"
        },
        {
          "name": "external_bribe",
          "reason": "no synonym found"
        },
        {
          "name": "rewards",
          "reason": "no synonym found"
        },
        {
          "name": "_balances",
          "reason": "no synonym found"
        },
        {
          "name": "claimed0",
          "reason": "no synonym found"
        },
        {
          "name": "claimed1",
          "reason": "no synonym found"
        },
        {
          "name": "gauge",
          "reason": "no synonym found"
        },
        {
          "name": "onlyDistribution",
          "reason": "no synonym found"
        },
        {
          "name": "EMER",
          "reason": "no synonym found"
        },
        {
          "name": "_rHYBR",
          "reason": "no synonym found"
        },
        {
          "name": "_ve",
          "reason": "no synonym found"
        },
        {
          "name": "_token",
          "reason": "no synonym found"
        },
        {
          "name": "_distribution",
          "reason": "no synonym found"
        },
        {
          "name": "_internal_bribe",
          "reason": "no synonym found"
        },
        {
          "name": "_external_bribe",
          "reason": "no synonym found"
        },
        {
          "name": "main",
          "reason": "no synonym found"
        },
        {
          "name": "vested",
          "reason": "no synonym found"
        },
        {
          "name": "underlying",
          "reason": "no synonym found"
        },
        {
          "name": "distro",
          "reason": "no synonym found"
        },
        {
          "name": "WEEK",
          "reason": "no synonym found"
        },
        {
          "name": "fees",
          "reason": "no synonym found"
        },
        {
          "name": "goes",
          "reason": "no synonym found"
        },
        {
          "name": "here",
          "reason": "no synonym found"
        },
        {
          "name": "bribe",
          "reason": "no synonym found"
        },
        {
          "name": "boolean",
          "reason": "no synonym found"
        },
        {
          "name": "ONLY",
          "reason": "no synonym found"
        },
        {
          "name": "notice",
          "reason": "no synonym found"
        },
        {
          "name": "distribution",
          "reason": "no synonym found"
        },
        {
          "name": "should",
          "reason": "no synonym found"
        },
        {
          "name": "SAME_ADDR",
          "reason": "no synonym found"
        },
        {
          "name": "rewarder",
          "reason": "no synonym found"
        },
        {
          "name": "_gaugeRewarder",
          "reason": "no synonym found"
        },
        {
          "name": "where",
          "reason": "no synonym found"
        },
        {
          "name": "_int",
          "reason": "no synonym found"
        },
        {
          "name": "FUNCTIONS",
          "reason": "no synonym found"
        },
        {
          "name": "held",
          "reason": "no synonym found"
        },
        {
          "name": "sinle",
          "reason": "no synonym found"
        },
        {
          "name": "see",
          "reason": "no synonym found"
        },
        {
          "name": "the",
          "reason": "no synonym found"
        },
        {
          "name": "INTERACTION",
          "reason": "no synonym found"
        },
        {
          "name": "whole",
          "reason": "no synonym found"
        },
        {
          "name": "additional",
          "reason": "no synonym found"
        },
        {
          "name": "param",
          "reason": "no synonym found"
        },
        {
          "name": "all",
          "reason": "no synonym found"
        },
        {
          "name": "_deposit",
          "reason": "no synonym found"
        },
        {
          "name": "_withdraw",
          "reason": "no synonym found"
        },
        {
          "name": "certain",
          "reason": "no synonym found"
        },
        {
          "name": "MATURE",
          "reason": "no synonym found"
        },
        {
          "name": "_amount",
          "reason": "no synonym found"
        },
        {
          "name": "and",
          "reason": "no synonym found"
        },
        {
          "name": "called",
          "reason": "no synonym found"
        },
        {
          "name": "allows",
          "reason": "no synonym found"
        },
        {
          "name": "multiple",
          "reason": "no synonym found"
        },
        {
          "name": "gauges",
          "reason": "no synonym found"
        },
        {
          "name": "_user",
          "reason": "no synonym found"
        },
        {
          "name": "dev",
          "reason": "no synonym found"
        },
        {
          "name": "remaining",
          "reason": "no synonym found"
        },
        {
          "name": "leftover",
          "reason": "no synonym found"
        },
        {
          "name": "Ensure",
          "reason": "no synonym found"
        },
        {
          "name": "provided",
          "reason": "no synonym found"
        },
        {
          "name": "not",
          "reason": "no synonym found"
        },
        {
          "name": "more",
          "reason": "no synonym found"
        },
        {
          "name": "than",
          "reason": "no synonym found"
        },
        {
          "name": "very",
          "reason": "no synonym found"
        },
        {
          "name": "high",
          "reason": "no synonym found"
        },
        {
          "name": "values",
          "reason": "no synonym found"
        },
        {
          "name": "functions",
          "reason": "no synonym found"
        },
        {
          "name": "_fees0",
          "reason": "no synonym found"
        },
        {
          "name": "_fees1",
          "reason": "no synonym found"
        },
        {
          "name": "_token0",
          "reason": "no synonym found"
        },
        {
          "name": "_token1",
          "reason": "no synonym found"
        }
      ],
      "meets_threshold": false
    },
    "rename_map": {
      "token": "crystal",
      "utils": "gameUtils",
      "IPair": "ICouple",
      "HybraTimeLibrary": "HybraInstantLibrary",
      "from": "origin",
      "onReward": "onBonus",
      "user": "hero",
      "recipient": "target",
      "userBalance": "heroLootbalance",
      "isForPair": "isForDuo",
      "emergency": "critical",
      "rewardToken": "bonusGem",
      "TOKEN": "Medal",
      "DURATION": "QuestLength",
      "_periodFinish": "_intervalFinish",
      "rewardRate": "bonusRatio",
      "lastUpdateTime": "endingSyncprogressInstant",
      "rewardPerTokenStored": "payoutPerMedalStored",
      "userRewardPerTokenPaid": "playerBountyPerCrystalPaid",
      "_totalSupply": "_aggregateReserve",
      "maturityTime": "maturityInstant",
      "RewardAdded": "PrizeAdded",
      "reward": "bonus",
      "Deposit": "StashRewards",
      "amount": "quantity",
      "Withdraw": "HarvestGold",
      "Harvest": "FarmBounty",
      "ClaimFees": "ObtainrewardFees",
      "EmergencyActivated": "UrgentActivated",
      "timestamp": "adventureTime",
      "EmergencyDeactivated": "CriticalDeactivated",
      "updateReward": "syncprogressBounty",
      "account": "character",
      "rewardPerToken": "payoutPerCrystal",
      "lastTimeRewardApplicable": "endingInstantBountyApplicable",
      "earned": "accumulated",
      "sender": "initiator",
      "isNotEmergency": "isNotCritical",
      "_rewardToken": "_treasureMedal",
      "_isForPair": "_isForDuo",
      "GaugeManager": "GaugeHandler",
      "pair": "couple",
      "claim_fees": "obtainreward_fees",
      "flag": "indicator",
      "set": "establish",
      "setDistribution": "collectionDistribution",
      "setGaugeRewarder": "groupGaugeRewarder",
      "setInternalBribe": "collectionInternalBribe",
      "activateEmergencyMode": "activateCriticalMode",
      "stopEmergencyMode": "stopCriticalMode",
      "total": "aggregate",
      "supply": "provideResources",
      "_balanceOf": "_treasureamountOf",
      "last": "ending",
      "time": "instant",
      "min": "floor",
      "get": "obtain",
      "duration": "questLength",
      "rewardForDuration": "treasureForQuestlength",
      "periodFinish": "durationFinish",
      "USER": "Player",
      "liquidity": "reserves",
      "deposit": "stashRewards",
      "depositAll": "cacheprizeAll",
      "nonReentrant": "oneAtATime",
      "withdraw": "obtainPrize",
      "withdrawAll": "claimAllLoot",
      "safeTransfer": "secureMove",
      "emergencyWithdraw": "criticalExtractwinnings",
      "emergencyWithdrawAmount": "urgentGathertreasureQuantity",
      "harvest": "collectGrowth",
      "withdrawAllAndHarvest": "collectbountyAllAndFarmbounty",
      "_redeemType": "_convertprizeType",
      "getReward": "fetchBonus",
      "User": "Player198",
      "safeApprove": "safeAllowusage",
      "depostionEmissionsToken": "depostionEmissionsCoin",
      "redeemFor": "convertprizeFor",
      "notifyRewardAmount": "notifyPayoutMeasure",
      "rewardsPerToken": "rewardsPerCoin",
      "REWARD_HIGH": "bonus_high",
      "claimFees": "collectbountyFees",
      "_claimFees": "_obtainrewardFees",
      "tokens": "crystals"
    }
  }
}