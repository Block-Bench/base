{
  "id": "ch_medical_nc_gs_006",
  "contract_file": "contracts/ch_medical_nc_gs_006.sol",
  "subset": "chameleon_medical",
  "ground_truth": {
    "is_vulnerable": true,
    "vulnerability_type": "logic_error",
    "severity": "medium",
    "vulnerable_location": {
      "contract_name": "ClinicalMetricsGauge",
      "function_name": "notifyCreditQuantity",
      "line_numbers": [
        251
      ]
    },
    "root_cause": "The `notifyRewardAmount()` function miscalculates the `rewardRate` when a new epoch begins, causing `rollover` rewards from previous epochs to be permanently lost. When `block.timestamp >= _periodFinish`, the function adds both the new `rewardAmount` and the previous epoch\u2019s `clPool.rollover()` to form the `totalRewardAmount`. However, the `rewardRate` is derived only from `rewardAmount`, ignoring the rollover portion: // @audit The total amount to be reserved includes rollover... uint256 totalRewardAmount = rewardAmount + clPool.rollover(); // @audit but the rate calculation completely ignores the rollover. rewardRate = rewardAmount / epochTimeRemaining; // @audit The pool is synced with a CORRECT",
    "attack_vector": "Refer to original submission for PoC (not detailed here).",
    "impact": "Severity: medium",
    "correct_fix": "Use `totalRewardAmount = rewardAmount + clPool.rollover()` for `rewardRate = totalRewardAmount / epochTimeRemaining`. Status: Mitigation confirmed."
  },
  "provenance": {
    "source": "code4rena",
    "original_id": "gs_c4_2025-10-hybra-finance_M05",
    "url": "https://code4rena.com/reports/2025-10-hybra-finance",
    "date_discovered": "2025-10-06",
    "date_added": "2025-12-16",
    "added_by": "benchmark_team"
  },
  "code_metadata": {
    "solidity_version": "^0.8.0",
    "num_lines": 372,
    "num_contracts": 1,
    "contract_names": [],
    "num_functions": 0,
    "has_imports": false,
    "imports": [],
    "has_inheritance": false,
    "inherits_from": [],
    "has_modifiers": false,
    "has_events": false,
    "has_assembly": false,
    "compilation_verified": false,
    "compiler_version_used": null
  },
  "tags": [
    "logic_error",
    "code4rena",
    "gold_standard",
    "audit_finding"
  ],
  "notes": "Reward rate calculation excludes rollover amounts, leading to permanent loss of carried-over rewards in new epochs.",
  "gold_standard_fields": {
    "source_report": "2025-10-hybra-finance",
    "source_finding_id": "M-05",
    "finding_title": "Rollover rewards are permanently lost due to flawed rewardRate calculation",
    "difficulty_tier": 2,
    "context_level": "single_file",
    "has_context": false,
    "call_flow": "notifyRewardAmount(new reward) -> rollover() added to total but ignored in rewardRate -> stranded rewards overwritten"
  },
  "evaluation_support": {
    "annotated_contract": "labelled_data/gold_standard/contracts/gs_006.sol",
    "detailed_metadata": "labelled_data/gold_standard/metadata/gs_006.json",
    "original_finding_title": "Rollover rewards are permanently lost due to flawed rewardRate calculation"
  },
  "original_subset": "gold_standard",
  "original_contract_file": "base/contracts/gs_006.sol",
  "sanitized_from": "gs_006",
  "derived_from": "sn_gs_006",
  "original_id": "gs_006",
  "identifier_mappings": {
    "token": "credential",
    "utils": "medicalUtils",
    "EnumerableSet": "EnumerableCollection",
    "IERC721Receiver": "Ierc721Patient",
    "IGaugeManager": "IGaugeCoordinator",
    "INonfungiblePositionManager": "INonfungiblePositionCoordinator",
    "HybraTimeLibrary": "HybraInstantLibrary",
    "from": "source",
    "GaugeCL": "ClinicalMetricsGauge",
    "UintSet": "NumberCollection",
    "rewardToken": "benefitCredential",
    "DURATION": "TreatmentPeriod",
    "_periodFinish": "_intervalFinish",
    "rewardRate": "benefitRate",
    "poolAddress": "poolWard",
    "nonfungiblePositionManager": "nonfungiblePositionHandler",
    "emergency": "urgent",
    "isForPair": "isForCouple",
    "factory": "wardFactory",
    "rewardRateByEpoch": "benefitRatioByEra",
    "rewardGrowthInside": "coverageGrowthInside",
    "rewards": "benefits",
    "lastUpdateTime": "endingUpdaterecordsInstant",
    "RewardAdded": "CoverageAdded",
    "reward": "credit",
    "Deposit": "SubmitPayment",
    "user": "patient",
    "amount": "quantity",
    "Withdraw": "DischargeFunds",
    "Harvest": "CollectAccruedBenefits",
    "ClaimFees": "CollectbenefitsServicecharges",
    "EmergencyActivated": "UrgentActivated",
    "timestamp": "admissionTime",
    "EmergencyDeactivated": "CriticalDeactivated",
    "_rewardToken": "_benefitCredential",
    "_isForPair": "_isForCouple",
    "sender": "requestor",
    "Caller": "Requestor",
    "RewardsDistribution": "BenefitsDistribution",
    "isNotEmergency": "isNotCritical",
    "_updateRewards": "_updaterecordsBenefits",
    "tokenId": "credentialId",
    "updateRewardsGrowthGlobal": "updaterecordsBenefitsGrowthGlobal",
    "getRewardGrowthInside": "acquireCoverageGrowthInside",
    "activateEmergencyMode": "activateUrgentMode",
    "stopEmergencyMode": "stopCriticalMode",
    "liquidity": "availableResources",
    "_getPoolAddress": "_obtainPoolWard",
    "getPool": "retrievePool",
    "earned": "accumulated",
    "lastUpdated": "finalUpdated",
    "timeDelta": "instantDelta",
    "rewardGrowthGlobalX128": "creditGrowthGlobalX128",
    "rewardReserve": "creditReserve",
    "stakedLiquidity": "committedAvailableresources",
    "rewardPerTokenInsideInitialX128": "coveragePerCredentialInsideInitialX128",
    "rewardPerTokenInsideX128": "coveragePerCredentialInsideX128",
    "deposit": "submitPayment",
    "nonReentrant": "singleTransaction",
    "Pool": "CarePool",
    "Position": "CarePosition",
    "pool": "patientPool",
    "collect": "gatherBenefits",
    "CollectParams": "GatherbenefitsParameters",
    "recipient": "beneficiary",
    "amount0Max": "amount0Maximum",
    "max": "maximum",
    "amount1Max": "amount1Maximum",
    "stake": "commitResources",
    "rewardGrowth": "coverageGrowth",
    "add": "append",
    "withdraw": "dischargeFunds",
    "redeemType": "claimresourcesType",
    "liquidityToStake": "availableresourcesDestinationPledge",
    "_getReward": "_retrieveCoverage",
    "remove": "discontinue",
    "getReward": "retrieveBenefit",
    "account": "profile",
    "rewardAmount": "creditQuantity",
    "safeApprove": "safeAuthorizeaccess",
    "depostionEmissionsToken": "depostionEmissionsCredential",
    "redeemFor": "claimresourcesFor",
    "notifyRewardAmount": "notifyCreditQuantity",
    "currentRate": "activeRatio",
    "epochTimeRemaining": "periodInstantRemaining",
    "epochNext": "periodFollowing",
    "epochEndTimestamp": "periodFinishAppointmenttime",
    "totalRewardAmount": "totalamountCoverageQuantity",
    "syncReward": "alignCredit",
    "periodFinish": "intervalFinish",
    "pendingRewards": "awaitingBenefits",
    "epochStart": "periodBegin",
    "contractBalance": "agreementAccountcredits",
    "rate": "frequency",
    "gaugeBalances": "gaugeAccountcreditsmap",
    "gaugeFees": "gaugeServicecharges",
    "claimFees": "obtaincoverageServicecharges",
    "_claimFees": "_obtaincoverageServicecharges",
    "collectFees": "gatherbenefitsServicecharges",
    "rewardForDuration": "coverageForStaylength",
    "setInternalBribe": "groupInternalBribe",
    "_safeTransfer": "_safeTransfercare",
    "value": "measurement",
    "length": "extent",
    "success": "improvement",
    "data": "record",
    "selector": "picker",
    "operator": "caregiver"
  },
  "transformation": {
    "strategy": "chameleon",
    "theme": "medical",
    "source": "nocomments",
    "seed": 1892645964,
    "coverage": {
      "total_identifiers": 175,
      "transformed": 108,
      "untransformed": 67,
      "skipped_reserved": 55,
      "skipped_interface": 0,
      "coverage_percent": 61.71,
      "untransformed_details": [
        {
          "name": "openzeppelin",
          "reason": "no synonym found"
        },
        {
          "name": "contracts",
          "reason": "no synonym found"
        },
        {
          "name": "security",
          "reason": "no synonym found"
        },
        {
          "name": "ReentrancyGuard",
          "reason": "no synonym found"
        },
        {
          "name": "sol",
          "reason": "no synonym found"
        },
        {
          "name": "access",
          "reason": "no synonym found"
        },
        {
          "name": "Ownable",
          "reason": "no synonym found"
        },
        {
          "name": "ERC20",
          "reason": "no synonym found"
        },
        {
          "name": "SafeERC20",
          "reason": "no synonym found"
        },
        {
          "name": "IERC20",
          "reason": "no synonym found"
        },
        {
          "name": "structs",
          "reason": "no synonym found"
        },
        {
          "name": "ERC721",
          "reason": "no synonym found"
        },
        {
          "name": "math",
          "reason": "no synonym found"
        },
        {
          "name": "SafeCast",
          "reason": "no synonym found"
        },
        {
          "name": "interfaces",
          "reason": "no synonym found"
        },
        {
          "name": "IGaugeFactoryCL",
          "reason": "no synonym found"
        },
        {
          "name": "ICLPool",
          "reason": "no synonym found"
        },
        {
          "name": "ICLFactory",
          "reason": "no synonym found"
        },
        {
          "name": "IBribe",
          "reason": "no synonym found"
        },
        {
          "name": "IRHYBR",
          "reason": "no synonym found"
        },
        {
          "name": "libraries",
          "reason": "no synonym found"
        },
        {
          "name": "FullMath",
          "reason": "no synonym found"
        },
        {
          "name": "FixedPoint128",
          "reason": "no synonym found"
        },
        {
          "name": "rHYBR",
          "reason": "no synonym found"
        },
        {
          "name": "DISTRIBUTION",
          "reason": "no synonym found"
        },
        {
          "name": "internal_bribe",
          "reason": "no synonym found"
        },
        {
          "name": "external_bribe",
          "reason": "no synonym found"
        },
        {
          "name": "clPool",
          "reason": "no synonym found"
        },
        {
          "name": "_stakes",
          "reason": "no synonym found"
        },
        {
          "name": "claimed0",
          "reason": "no synonym found"
        },
        {
          "name": "claimed1",
          "reason": "no synonym found"
        },
        {
          "name": "gauge",
          "reason": "no synonym found"
        },
        {
          "name": "_rHYBR",
          "reason": "no synonym found"
        },
        {
          "name": "_ve",
          "reason": "no synonym found"
        },
        {
          "name": "_pool",
          "reason": "no synonym found"
        },
        {
          "name": "_distribution",
          "reason": "no synonym found"
        },
        {
          "name": "_internal_bribe",
          "reason": "no synonym found"
        },
        {
          "name": "_external_bribe",
          "reason": "no synonym found"
        },
        {
          "name": "nfpm",
          "reason": "no synonym found"
        },
        {
          "name": "_factory",
          "reason": "no synonym found"
        },
        {
          "name": "WEEK",
          "reason": "no synonym found"
        },
        {
          "name": "onlyDistribution",
          "reason": "no synonym found"
        },
        {
          "name": "not",
          "reason": "no synonym found"
        },
        {
          "name": "tickLower",
          "reason": "no synonym found"
        },
        {
          "name": "tickUpper",
          "reason": "no synonym found"
        },
        {
          "name": "_earned",
          "reason": "no synonym found"
        },
        {
          "name": "positions",
          "reason": "no synonym found"
        },
        {
          "name": "token0",
          "reason": "no synonym found"
        },
        {
          "name": "token1",
          "reason": "no synonym found"
        },
        {
          "name": "tickSpacing",
          "reason": "no synonym found"
        },
        {
          "name": "contains",
          "reason": "no synonym found"
        },
        {
          "name": "mulDiv",
          "reason": "no synonym found"
        },
        {
          "name": "Q128",
          "reason": "no synonym found"
        },
        {
          "name": "claimable",
          "reason": "no synonym found"
        },
        {
          "name": "Gauge",
          "reason": "no synonym found"
        },
        {
          "name": "zero",
          "reason": "no synonym found"
        },
        {
          "name": "positionPool",
          "reason": "no synonym found"
        },
        {
          "name": "mismatch",
          "reason": "no synonym found"
        },
        {
          "name": "Invalid",
          "reason": "no synonym found"
        },
        {
          "name": "rollover",
          "reason": "no synonym found"
        },
        {
          "name": "Insufficient",
          "reason": "no synonym found"
        },
        {
          "name": "_token0",
          "reason": "no synonym found"
        },
        {
          "name": "_token1",
          "reason": "no synonym found"
        },
        {
          "name": "_fees0",
          "reason": "no synonym found"
        },
        {
          "name": "_fees1",
          "reason": "no synonym found"
        },
        {
          "name": "_int",
          "reason": "no synonym found"
        },
        {
          "name": "onERC721Received",
          "reason": "no synonym found"
        }
      ],
      "meets_threshold": false
    },
    "rename_map": {
      "token": "credential",
      "utils": "medicalUtils",
      "EnumerableSet": "EnumerableCollection",
      "IERC721Receiver": "Ierc721Patient",
      "IGaugeManager": "IGaugeCoordinator",
      "INonfungiblePositionManager": "INonfungiblePositionCoordinator",
      "HybraTimeLibrary": "HybraInstantLibrary",
      "from": "source",
      "GaugeCL": "ClinicalMetricsGauge",
      "UintSet": "NumberCollection",
      "rewardToken": "benefitCredential",
      "DURATION": "TreatmentPeriod",
      "_periodFinish": "_intervalFinish",
      "rewardRate": "benefitRate",
      "poolAddress": "poolWard",
      "nonfungiblePositionManager": "nonfungiblePositionHandler",
      "emergency": "urgent",
      "isForPair": "isForCouple",
      "factory": "wardFactory",
      "rewardRateByEpoch": "benefitRatioByEra",
      "rewardGrowthInside": "coverageGrowthInside",
      "rewards": "benefits",
      "lastUpdateTime": "endingUpdaterecordsInstant",
      "RewardAdded": "CoverageAdded",
      "reward": "credit",
      "Deposit": "SubmitPayment",
      "user": "patient",
      "amount": "quantity",
      "Withdraw": "DischargeFunds",
      "Harvest": "CollectAccruedBenefits",
      "ClaimFees": "CollectbenefitsServicecharges",
      "EmergencyActivated": "UrgentActivated",
      "timestamp": "admissionTime",
      "EmergencyDeactivated": "CriticalDeactivated",
      "_rewardToken": "_benefitCredential",
      "_isForPair": "_isForCouple",
      "sender": "requestor",
      "Caller": "Requestor",
      "RewardsDistribution": "BenefitsDistribution",
      "isNotEmergency": "isNotCritical",
      "_updateRewards": "_updaterecordsBenefits",
      "tokenId": "credentialId",
      "updateRewardsGrowthGlobal": "updaterecordsBenefitsGrowthGlobal",
      "getRewardGrowthInside": "acquireCoverageGrowthInside",
      "activateEmergencyMode": "activateUrgentMode",
      "stopEmergencyMode": "stopCriticalMode",
      "liquidity": "availableResources",
      "_getPoolAddress": "_obtainPoolWard",
      "getPool": "retrievePool",
      "earned": "accumulated",
      "lastUpdated": "finalUpdated",
      "timeDelta": "instantDelta",
      "rewardGrowthGlobalX128": "creditGrowthGlobalX128",
      "rewardReserve": "creditReserve",
      "stakedLiquidity": "committedAvailableresources",
      "rewardPerTokenInsideInitialX128": "coveragePerCredentialInsideInitialX128",
      "rewardPerTokenInsideX128": "coveragePerCredentialInsideX128",
      "deposit": "submitPayment",
      "nonReentrant": "singleTransaction",
      "Pool": "CarePool",
      "Position": "CarePosition",
      "pool": "patientPool",
      "collect": "gatherBenefits",
      "CollectParams": "GatherbenefitsParameters",
      "recipient": "beneficiary",
      "amount0Max": "amount0Maximum",
      "max": "maximum",
      "amount1Max": "amount1Maximum",
      "stake": "commitResources",
      "rewardGrowth": "coverageGrowth",
      "add": "append",
      "withdraw": "dischargeFunds",
      "redeemType": "claimresourcesType",
      "liquidityToStake": "availableresourcesDestinationPledge",
      "_getReward": "_retrieveCoverage",
      "remove": "discontinue",
      "getReward": "retrieveBenefit",
      "account": "profile",
      "rewardAmount": "creditQuantity",
      "safeApprove": "safeAuthorizeaccess",
      "depostionEmissionsToken": "depostionEmissionsCredential",
      "redeemFor": "claimresourcesFor",
      "notifyRewardAmount": "notifyCreditQuantity",
      "currentRate": "activeRatio",
      "epochTimeRemaining": "periodInstantRemaining",
      "epochNext": "periodFollowing",
      "epochEndTimestamp": "periodFinishAppointmenttime",
      "totalRewardAmount": "totalamountCoverageQuantity",
      "syncReward": "alignCredit",
      "periodFinish": "intervalFinish",
      "pendingRewards": "awaitingBenefits",
      "epochStart": "periodBegin",
      "contractBalance": "agreementAccountcredits",
      "rate": "frequency",
      "gaugeBalances": "gaugeAccountcreditsmap",
      "gaugeFees": "gaugeServicecharges",
      "claimFees": "obtaincoverageServicecharges",
      "_claimFees": "_obtaincoverageServicecharges",
      "collectFees": "gatherbenefitsServicecharges",
      "rewardForDuration": "coverageForStaylength",
      "setInternalBribe": "groupInternalBribe",
      "_safeTransfer": "_safeTransfercare",
      "value": "measurement",
      "length": "extent",
      "success": "improvement",
      "data": "record",
      "selector": "picker",
      "operator": "caregiver"
    }
  }
}