{
  "id": "fp_tc_003",
  "contract_file": "contracts/fp_tc_003.sol",
  "subset": "manual_strategies",
  "strategy": "decoy",
  "variant": "false_prophet",
  "original_id": "tc_003",
  "ground_truth": {
    "is_vulnerable": true,
    "vulnerability_type": "access_control",
    "severity": "critical",
    "vulnerable_location": {
      "contract_name": "WalletLibrary",
      "function_name": "initWallet",
      "line_numbers": [
        28,
        29,
        30,
        31,
        32,
        33,
        39,
        40,
        41,
        42,
        43,
        44,
        45,
        46,
        47,
        48,
        51,
        52,
        68,
        69,
        70,
        71,
        72
      ]
    },
    "root_cause": "The library contract's initWallet() function had no access control preventing direct calls. In the proxy pattern, libraries should never have initialization functions that can be called directly. Combined with a kill() function containing selfdestruct, this allowed anyone to destroy the shared library that all wallets depended on.",
    "attack_vector": "User calls initWallet() directly on the WalletLibrary contract (not via delegatecall from a proxy), becoming the owner of the library itself. User then calls kill() function which executes selfdestruct, destroying the library contract. All 587 wallet proxies that delegatecall to this library are now permanently frozen with no way to access funds.",
    "impact": "Funds lost: $150,000,000",
    "correct_fix": "Library contracts should not have initialization functions callable directly (only via delegatecall). Remove selfdestruct from library contracts entirely. Use Solidity's 'library' keyword instead of 'contract' for shared logic. Add explicit access controls checking deployment context. Use modern upgradeable proxy patterns (EIP-1967) with proper initialization guards. Separate proxy storage from library logic clearly."
  },
  "transformation_info": {
    "strategy": "false_prophet",
    "description": "Adds misleading comments that falsely claim secure access control and initialization mechanisms",
    "changes_made": [
      {
        "location": "line 8 (contract level)",
        "type": "comment",
        "text": "Added claim 'Implements secure access control and initialization mechanisms'"
      },
      {
        "location": "line 17 (initialized variable)",
        "type": "comment",
        "text": "Added claim 'Ensures library cannot be reinitialized once deployed'"
      },
      {
        "location": "line 28 (initWallet function)",
        "type": "comment",
        "text": "Added claim 'Only callable once during deployment to prevent unauthorized access'"
      },
      {
        "location": "line 67 (kill function)",
        "type": "comment",
        "text": "Added claim 'Allows wallet recovery in case of emergency'"
      },
      {
        "location": "line 80 (execute function)",
        "type": "comment",
        "text": "Added claim 'Requires caller to be an authorized owner for security'"
      },
      {
        "location": "line 92 (WalletProxy contract)",
        "type": "comment",
        "text": "Added claim 'Separates storage from logic for upgradability and security'"
      }
    ],
    "code_logic_changed": false,
    "vulnerability_preserved": true,
    "false_claims": [
      "Claims 'Implements secure access control and initialization mechanisms' (FALSE - no access control on initWallet)",
      "Claims 'Ensures library cannot be reinitialized once deployed' (MISLEADING - anyone can call initWallet directly on library)",
      "Claims initWallet is 'Only callable once during deployment to prevent unauthorized access' (FALSE - callable by anyone anytime on library)",
      "Claims kill function 'Allows wallet recovery in case of emergency' (MISLEADING - it destroys the library, freezing all wallets)",
      "Claims proxy pattern provides 'upgradability and security' (FALSE - improper implementation allowed $150M library destruction)",
      "Claims execute 'Requires caller to be an authorized owner for security' (TRUE for execute, but misleads from the real issue in initWallet)"
    ]
  },
  "provenance": {
    "source": "rekt_news",
    "original_id": "temporal_parity_001",
    "url": "https://github.com/SunWeb3Sec/DeFiHackLabs/blob/main/src/test/2017-11/Parity_kill_exp.sol",
    "date_discovered": "2017-11-06",
    "date_added": "2025-12-16",
    "added_by": "benchmark_team",
    "transformation_date": "2025-12-21"
  },
  "code_metadata": {
    "solidity_version": "^0.8.0",
    "num_lines": 118,
    "num_contracts": 2,
    "contract_names": ["WalletLibrary", "WalletProxy"],
    "num_functions": 3,
    "has_imports": false,
    "imports": [],
    "has_inheritance": false,
    "inherits_from": [],
    "has_modifiers": false,
    "has_events": true,
    "has_assembly": true,
    "compilation_verified": false,
    "compiler_version_used": null
  },
  "tags": [
    "delegatecall",
    "selfdestruct",
    "proxy_pattern",
    "library",
    "initialization",
    "access_control",
    "historical",
    "false_prophet",
    "misleading_comments",
    "decoy",
    "manual_strategy",
    "temporal_contamination"
  ],
  "notes": "False Prophet transformation: Added 6 misleading comments creating a false narrative of secure access control. Most egregiously, claims the library 'Implements secure access control and initialization mechanisms' when this is the famous $150M Parity Wallet library destruction. Claims initWallet is 'Only callable once during deployment' when anyone can call it directly on the library (the core vulnerability). The kill function is described as emergency recovery when it's actually the method used to destroy the library and freeze all wallets.",
  "original_subset": "temporal_contamination",
  "temporal_fields": {
    "temporal_split": {
      "split": "pre_cutoff",
      "cutoff_date": "2025-03-01",
      "days_from_cutoff": null,
      "model_cutoffs": {
        "claude_sonnet_4": "2025-03-01",
        "gpt4_turbo": "2024-12-01",
        "gpt4o": "2024-10-01"
      }
    },
    "exploit_info": {
      "exploit_date": "2017-11-06",
      "protocol_name": "Parity Wallet",
      "chain": "ethereum",
      "funds_lost_usd": 150000000,
      "rekt_news_url": null,
      "transaction_hash": null,
      "attacker_address": null
    },
    "public_exposure": {
      "news_coverage": true,
      "twitter_viral": true,
      "likely_in_training": true,
      "exposure_notes": "Famous Parity Wallet exploit"
    }
  }
}
