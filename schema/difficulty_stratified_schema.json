{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Difficulty Stratified Sample Schema",
  "description": "Schema for difficulty stratified dataset samples - vulnerabilities organized by complexity tiers",
  "type": "object",
  "required": [
    "id",
    "contract_file",
    "subset",
    "ground_truth",
    "provenance",
    "code_metadata",
    "difficulty_fields",
    "evaluation_support"
  ],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this sample",
      "pattern": "^ds_[0-9]{3}$"
    },

    "contract_file": {
      "type": "string",
      "description": "Relative path to contract file from dataset root",
      "pattern": "^contracts/ds_[0-9]{3}\\.(sol|rs)$"
    },

    "subset": {
      "type": "string",
      "const": "difficulty_stratified",
      "description": "Dataset this sample belongs to"
    },

    "ground_truth": {
      "type": "object",
      "required": ["is_vulnerable"],
      "properties": {
        "is_vulnerable": {
          "type": "boolean",
          "description": "Whether the contract contains an exploitable vulnerability"
        },

        "vulnerability_type": {
          "type": ["string", "null"],
          "enum": [
            "reentrancy",
            "access_control",
            "integer_overflow",
            "integer_underflow",
            "unchecked_return",
            "tx_origin",
            "timestamp_dependency",
            "front_running",
            "denial_of_service",
            "logic_error",
            "oracle_manipulation",
            "flash_loan",
            "price_manipulation",
            "signature_replay",
            "delegate_call",
            "self_destruct",
            "uninitialized_storage",
            "other",
            null
          ],
          "description": "Primary vulnerability type (null if not vulnerable)"
        },

        "severity": {
          "type": ["string", "null"],
          "enum": ["critical", "high", "medium", "low", null],
          "description": "Severity rating (null if not vulnerable)"
        },

        "vulnerable_location": {
          "type": ["object", "null"],
          "properties": {
            "contract_name": {
              "type": "string",
              "description": "Name of the contract/module containing vulnerability"
            },
            "function_name": {
              "type": ["string", "null"],
              "description": "Function where vulnerability exists"
            },
            "line_numbers": {
              "type": "array",
              "items": { "type": "integer" },
              "description": "Line numbers of vulnerable code"
            }
          },
          "description": "Location details of the vulnerability"
        },

        "root_cause": {
          "type": ["string", "null"],
          "description": "Technical explanation of why the vulnerability exists"
        },

        "attack_vector": {
          "type": ["string", "null"],
          "description": "How an attacker would exploit this vulnerability"
        },

        "impact": {
          "type": ["string", "null"],
          "description": "Consequences of successful exploitation"
        },

        "correct_fix": {
          "type": ["string", "null"],
          "description": "How to remediate the vulnerability"
        }
      }
    },

    "provenance": {
      "type": "object",
      "required": ["source"],
      "properties": {
        "source": {
          "type": "string",
          "enum": [
            "code4rena",
            "sherlock",
            "immunefi",
            "solodit",
            "rekt_news",
            "trail_of_bits",
            "spearbit",
            "cyfrin",
            "pashov",
            "guardian",
            "openzeppelin",
            "consensys",
            "dedaub",
            "synthetic",
            "manual",
            "other"
          ],
          "description": "Origin of this sample"
        },

        "original_id": {
          "type": ["string", "null"],
          "description": "ID from the original source"
        },

        "url": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "URL to original report/finding"
        },

        "date_discovered": {
          "type": ["string", "null"],
          "format": "date",
          "description": "When the vulnerability was discovered/reported"
        },

        "date_added": {
          "type": "string",
          "format": "date",
          "description": "When this sample was added to the benchmark"
        },

        "added_by": {
          "type": ["string", "null"],
          "description": "Who added this sample"
        }
      }
    },

    "code_metadata": {
      "type": "object",
      "required": ["num_lines"],
      "properties": {
        "solidity_version": {
          "type": ["string", "null"],
          "description": "Solidity pragma version (N/A for Rust)"
        },

        "num_lines": {
          "type": "integer",
          "minimum": 1,
          "description": "Total lines of code"
        },

        "num_contracts": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "description": "Number of contracts/modules in the file"
        },

        "contract_names": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Names of all contracts/modules in the file"
        },

        "num_functions": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of functions"
        },

        "has_imports": {
          "type": "boolean",
          "description": "Whether the code has import/use statements"
        },

        "imports": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of imported files/packages"
        },

        "has_inheritance": {
          "type": "boolean",
          "description": "Whether any contract uses inheritance"
        },

        "inherits_from": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of inherited contracts"
        },

        "has_modifiers": {
          "type": "boolean",
          "description": "Whether custom modifiers are defined"
        },

        "has_events": {
          "type": "boolean",
          "description": "Whether events are defined"
        },

        "has_assembly": {
          "type": "boolean",
          "description": "Whether inline assembly is used"
        },

        "compilation_verified": {
          "type": "boolean",
          "description": "Whether this compiles successfully"
        },

        "compiler_version_used": {
          "type": ["string", "null"],
          "description": "Exact compiler version used for verification"
        }
      }
    },

    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Additional categorization tags",
      "default": []
    },

    "notes": {
      "type": ["string", "null"],
      "description": "Any additional notes about this sample"
    },

    "difficulty_fields": {
      "type": "object",
      "required": ["difficulty_tier"],
      "description": "Difficulty stratification specific fields",
      "properties": {
        "difficulty_tier": {
          "type": "integer",
          "enum": [1, 2, 3, 4, 5],
          "description": "Difficulty level (1=easiest, 5=hardest)"
        },

        "difficulty_tier_name": {
          "type": "string",
          "enum": [
            "textbook",
            "clear_audit",
            "subtle_audit",
            "multi_contract",
            "emergent"
          ],
          "description": "Human-readable tier name"
        },

        "complexity_analysis": {
          "type": "object",
          "properties": {
            "complexity_factors": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "single_function",
                  "multi_function",
                  "cross_contract",
                  "requires_state_analysis",
                  "requires_math_analysis",
                  "hidden_in_modifier",
                  "hidden_in_library",
                  "proxy_pattern",
                  "assembly_involved",
                  "state_conditional",
                  "time_dependent",
                  "economic_analysis_needed",
                  "requires_external_context"
                ]
              },
              "description": "Factors contributing to difficulty"
            },

            "detection_hints": {
              "type": ["string", "null"],
              "description": "What makes this detectable"
            },

            "detection_challenges": {
              "type": ["string", "null"],
              "description": "What makes this hard to detect"
            },

            "estimated_human_time_minutes": {
              "type": ["integer", "null"],
              "description": "Estimated time for human auditor to find"
            }
          }
        },

        "canonical_example": {
          "type": "boolean",
          "default": false,
          "description": "Whether this is a canonical/textbook example of its type"
        }
      }
    },

    "evaluation_support": {
      "type": "object",
      "required": ["annotated_contract", "detailed_metadata"],
      "description": "References to annotated versions for judge evaluation",
      "properties": {
        "annotated_contract": {
          "type": "string",
          "description": "Path to annotated contract file with vulnerability comments",
          "pattern": "^labelled_data/difficulty_stratified/contracts/ds_[0-9]{3}\\.(sol|rs)$"
        },

        "detailed_metadata": {
          "type": "string",
          "description": "Path to detailed metadata JSON with full context",
          "pattern": "^labelled_data/difficulty_stratified/metadata/ds_[0-9]{3}\\.json$"
        },

        "original_id": {
          "type": ["string", "null"],
          "description": "Original ID from source dataset"
        }
      }
    }
  }
}
